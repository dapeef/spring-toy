(()=>{"use strict";var t,i=(t=function(i,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])},t(i,s)},function(i,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function e(){this.constructor=i}t(i,s),i.prototype=null===s?Object.create(s):(e.prototype=s.prototype,new e)}),s=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},t.prototype.multiplyBy=function(t){this.x*=t,this.y*=t},t.prototype.normalize=function(){this.multiplyBy(1/this.length())},t.prototype.plus=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.minus=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.times=function(i){return new t(this.x*i,this.y*i)},t.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.normalized=function(){return 0===this.length()?this:this.times(1/this.length())},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.clamp=function(t){this.length()>t&&(this.normalize(),this.multiplyBy(t))},t.prototype.copy=function(){return new t(this.x,this.y)},t}(),e=function(){function t(t,i,e,o,n,h){void 0===t&&(t=new s(25,25)),void 0===i&&(i=1),void 0===e&&(e=1e-7),void 0===o&&(o=1),void 0===n&&(n=new s(50,50)),void 0===h&&(h=5e-4),this._position=t,this.mass=i,this.stiffness=e,this.damping=o,this._size=n,this.dragCoefficient=h,this.isBeingDragged=!1,this.relativeMousePosition=new s,this.springs=[],this._velocity=new s}return Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._position.x-this._size.x/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._position.x+this._size.x/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._position.y-this._size.y/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._position.y+this._size.y/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minSize",{get:function(){return Math.min(this._size.x,this._size.y)},enumerable:!1,configurable:!0}),t.prototype.addSpring=function(t){this.springs.push(t)},t.prototype.update=function(i,e,o,h,r,a){var p=this;if(this.isBeingDragged){var u=this._position.copy();this._position=o.minus(this.relativeMousePosition),this._velocity=this._position.minus(u).times(1/e)}else{var c=new s;c.add(new s(0,this.mass*h)),this.springs.forEach((function(t){c.add(t.getForce(p))}));var d=[];this.left<=0&&d.push(new n(this,new t(new s(-this._size.x/2,this._position.y)),this._size.x)),this.right>=i.width&&d.push(new n(this,new t(new s(i.width+this._size.x/2,this._position.y)),this._size.x)),this.top<=0&&d.push(new n(this,new t(new s(this._position.x,-this._size.y/2)),this._size.y)),this.bottom>=i.height&&d.push(new n(this,new t(new s(this._position.x,i.height+this._size.y/2)),this._size.y)),d.forEach((function(t){c.add(t.getForce(p))})),c.add(this._velocity.normalized().times(-this.dragCoefficient*Math.pow(this._velocity.length(),2)));var y=c.times(1/this.mass);this._velocity.add(y.times(e)),this._velocity.clamp(a),this._position.add(this._velocity.times(e)),this.right<=0&&(this._velocity.x=0,this._position.x=-this.size.x/2+1),this.left>=i.width&&(this._velocity.x=0,this._position.x=i.width+this.size.x/2-1),this.bottom<=0&&(this._velocity.y=0,this._position.y=-this.size.y/2+1),this.top>=i.height&&(this._velocity.y=0,this._position.y=i.height+this.size.y/2-1)}},t.prototype.draw=function(t){t.strokeStyle="black",t.beginPath(),t.ellipse(this._position.x,this._position.y,this._size.x/2,this._size.y/2,0,0,2*Math.PI),t.fill()},t}(),o=function(){function t(t,i,e,o,n){void 0===e&&(e=200),void 0===o&&(o=1e-4),void 0===n&&(n=.001),this.mass1=t,this.mass2=i,this.naturalLength=e,this.stiffness=o,this.damping=n,this.length=0,this.relativePos=new s,this.elasticForce=new s,this.dampingForce=new s,this.force=new s,this.defaultWidth=10,this.update()}return t.prototype.getForce=function(t){return t===this.mass2?this.force:this.force.times(-1)},t.prototype.update=function(){this.relativePos=this.mass1.position.minus(this.mass2.position),this.length=this.relativePos.length();var t=this.relativePos.normalized();this.elasticForce=t.times((this.length-this.naturalLength)*this.stiffness);var i=this.mass1.velocity.minus(this.mass2.velocity).dot(t);this.dampingForce=t.times(i*this.damping),this.force=this.elasticForce.plus(this.dampingForce)},t.prototype.draw=function(t){t.beginPath(),t.moveTo(this.mass1.position.x,this.mass1.position.y),t.lineTo(this.mass2.position.x,this.mass2.position.y),t.lineWidth=Math.min(this.defaultWidth*this.naturalLength/this.length,this.mass1.minSize,this.mass2.minSize),t.strokeStyle="gray",t.stroke()},t}(),n=function(t){function s(i,s,e,o,n){void 0===o&&(o=1e-5),void 0===n&&(n=.01);var h=t.call(this,s,i,e,o,n)||this;return h.mass1=i,h.mass2=s,h.naturalLength=e,h.stiffness=o,h.damping=n,h.hertzExponent=2,h.penaltyExponent=.5,h.update(),h}return i(s,t),s.prototype.update=function(){this.relativePos=this.mass1.position.minus(this.mass2.position),this.length=this.relativePos.length();var t=this.relativePos.normalized(),i=Math.pow(this.naturalLength-this.length,this.hertzExponent)*this.stiffness,s=1+1/Math.pow(this.length,this.penaltyExponent);this.elasticForce=t.times(i*s).times(-1);var e=this.mass1.velocity.minus(this.mass2.velocity).dot(t);this.dampingForce=t.times(e*this.damping),this.force=this.elasticForce.plus(this.dampingForce)},s}(o),h=function(){function t(t){this.canvas=t,this.isMouseDown=!1,this.mousePosition=new s,this.maxDeltaTime=50,this.gravity=5e-4,this.maxForce=.1,this.maxSpeed=1e4,this.ctx=t.getContext("2d"),this.lastTime=0,this.deltaTime=0,this.masses=[],this.springs=[]}return t.prototype.addMass=function(t){this.masses.push(t)},t.prototype.addSpring=function(t){this.springs.push(t),t.mass1.addSpring(t),t.mass2.addSpring(t)},t.prototype.mouseDown=function(t){var i=this;this.isMouseDown=!0,this.mousePosition.x=t.x,this.mousePosition.y=t.y,this.masses.forEach((function(s){s.position.x-s.size.x<=t.x&&s.position.x+s.size.x>=t.x&&s.position.y-s.size.y<=t.y&&s.position.y+s.size.y>=t.y&&(s.isBeingDragged=!0,s.relativeMousePosition=i.mousePosition.minus(s.position))}))},t.prototype.mouseMove=function(t){this.mousePosition.x=t.x,this.mousePosition.y=t.y},t.prototype.mouseUp=function(t){this.isMouseDown=!1,this.masses.forEach((function(t){return t.isBeingDragged=!1}))},t.prototype.start=function(){requestAnimationFrame(this.mainLoop.bind(this))},t.prototype.mainLoop=function(t){this.deltaTime=Math.min(t-this.lastTime,this.maxDeltaTime),this.lastTime=t,this.update(this.deltaTime),this.draw(),requestAnimationFrame(this.mainLoop.bind(this))},t.prototype.update=function(t){var i=this;this.masses.forEach((function(s){return s.update(i.canvas,t,i.mousePosition,i.gravity,i.maxForce,i.maxSpeed)})),this.springs.forEach((function(t){return t.update()}))},t.prototype.draw=function(){var t=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.springs.forEach((function(i){return i.draw(t.ctx)})),this.masses.forEach((function(i){return i.draw(t.ctx)}))},t}(),r=document.getElementById("canvas");function a(){r.width=window.innerWidth,r.height=window.innerHeight}window.addEventListener("resize",a),a();var p=new h(r);r.onmousedown=p.mouseDown.bind(p),r.onmousemove=p.mouseMove.bind(p),r.onmouseup=p.mouseUp.bind(p);var u=new e(new s(15,30)),c=new e(new s(30,300)),d=new e(new s(300,30)),y=new e(new s(300,300));p.addMass(u),p.addMass(c),p.addMass(d),p.addMass(y);var m=new o(u,c,300),l=new o(c,d),f=new o(u,d),g=new o(d,y),w=new o(c,y);p.addSpring(m),p.addSpring(l),p.addSpring(f),p.addSpring(g),p.addSpring(w),p.start()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFpQixTQUFVSixHQUNsQ0EsSUFHQSxJQUFNSyxFQUFPLElBQUlDLEVBQUszRSxHQUV0QkEsRUFBTzRFLFlBQWNGLEVBQUtsQixVQUFVTyxLQUFLVyxHQUN6QzFFLEVBQU82RSxZQUFjSCxFQUFLaEIsVUFBVUssS0FBS1csR0FDekMxRSxFQUFPOEUsVUFBWUosRUFBS2YsUUFBUUksS0FBS1csR0FFckMsSUFBSS9DLEVBQVEsSUFBSWYsRUFBSyxJQUFJdEMsRUFBUSxHQUFJLEtBQ2pDc0QsRUFBUSxJQUFJaEIsRUFBSyxJQUFJdEMsRUFBUSxHQUFJLE1BQ2pDeUcsRUFBUSxJQUFJbkUsRUFBSyxJQUFJdEMsRUFBUSxJQUFLLEtBQ2xDMEcsRUFBUSxJQUFJcEUsRUFBSyxJQUFJdEMsRUFBUSxJQUFLLE1BQ3RDb0csRUFBS25CLFFBQVE1QixHQUNiK0MsRUFBS25CLFFBQVEzQixHQUNiOEMsRUFBS25CLFFBQVF3QixHQUNiTCxFQUFLbkIsUUFBUXlCLEdBRWIsSUFBSUMsRUFBVSxJQUFJaEMsRUFBT3RCLEVBQU9DLEVBQU8sS0FDbkNzRCxFQUFVLElBQUlqQyxFQUFPckIsRUFBT21ELEdBQzVCSSxFQUFVLElBQUlsQyxFQUFPdEIsRUFBT29ELEdBQzVCSyxFQUFVLElBQUluQyxFQUFPOEIsRUFBT0MsR0FDNUJLLEVBQVUsSUFBSXBDLEVBQU9yQixFQUFPb0QsR0FDaENOLEVBQUs5RSxVQUFVcUYsR0FDZlAsRUFBSzlFLFVBQVVzRixHQUNmUixFQUFLOUUsVUFBVXVGLEdBQ2ZULEVBQUs5RSxVQUFVd0YsR0FDZlYsRUFBSzlFLFVBQVV5RixHQUVmWCxFQUFLZCxPIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3ByaW5nLXRveS8uL3NyYy9jbGFzc2VzLnRzIiwid2VicGFjazovL3NwcmluZy10b3kvLi9zcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVmVjdG9yMiB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgeDpudW1iZXIgPSAwLCBwdWJsaWMgeTpudW1iZXIgPSAwKSB7fTtcclxuXHJcbiAgICBwdWJsaWMgYWRkKHZlY3RvcjpWZWN0b3IyKTp2b2lkIHtcclxuICAgICAgICAvLyBBZGQgYW5vdGhlciBWZWN0b3IyIHRvIHRoaXMgVmVjdG9yMlxyXG4gICAgICAgIHRoaXMueCArPSB2ZWN0b3IueDtcclxuICAgICAgICB0aGlzLnkgKz0gdmVjdG9yLnk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBzdWJ0cmFjdCh2ZWN0b3I6VmVjdG9yMik6dm9pZCB7XHJcbiAgICAgICAgLy8gU3VidHJhY3QgYW5vdGhlciBWZWN0b3IyIGZyb20gdGhpcyBWZWN0b3IyXHJcbiAgICAgICAgdGhpcy54IC09IHZlY3Rvci54O1xyXG4gICAgICAgIHRoaXMueSAtPSB2ZWN0b3IueTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbXVsdGlwbHlCeShzY2FsYXI6bnVtYmVyKTp2b2lkIHtcclxuICAgICAgICAvLyBTdW0gdGhpcyBWZWN0b3IyIHdpdGggdGhlIG5lZ2F0aXZlIG9mIGFub3RoZXIgYW5kIHJldHVybiBhIG5ldyBWZWN0b3IyIG9mIHRoZSByZXN1bHRcclxuICAgICAgICB0aGlzLnggKj0gc2NhbGFyXHJcbiAgICAgICAgdGhpcy55ICo9IHNjYWxhcjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbm9ybWFsaXplKCk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5tdWx0aXBseUJ5KDEvdGhpcy5sZW5ndGgoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHBsdXModmVjdG9yOlZlY3RvcjIpOlZlY3RvcjIge1xyXG4gICAgICAgIC8vIFN1bSB0aGlzIFZlY3RvcjIgd2l0aCBhbm90aGVyIGFuZCByZXR1cm4gYSBuZXcgVmVjdG9yMiBvZiB0aGUgcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCArIHZlY3Rvci54LCB0aGlzLnkgKyB2ZWN0b3IueSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBtaW51cyh2ZWN0b3I6VmVjdG9yMik6VmVjdG9yMiB7XHJcbiAgICAgICAgLy8gU3VtIHRoaXMgVmVjdG9yMiB3aXRoIHRoZSBuZWdhdGl2ZSBvZiBhbm90aGVyIGFuZCByZXR1cm4gYSBuZXcgVmVjdG9yMiBvZiB0aGUgcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCAtIHZlY3Rvci54LCB0aGlzLnkgLSB2ZWN0b3IueSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRpbWVzKHNjYWxhcjpudW1iZXIpOlZlY3RvcjIge1xyXG4gICAgICAgIC8vIFN1bSB0aGlzIFZlY3RvcjIgd2l0aCB0aGUgbmVnYXRpdmUgb2YgYW5vdGhlciBhbmQgcmV0dXJuIGEgbmV3IFZlY3RvcjIgb2YgdGhlIHJlc3VsdFxyXG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih0aGlzLnggKiBzY2FsYXIsIHRoaXMueSAqIHNjYWxhcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGxlbmd0aCgpOm51bWJlciB7XHJcbiAgICAgICAgLy8gR2V0IGxlbmd0aCBvZiB0aGUgdmVjdG9yXHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyh0aGlzLngsIDIpICsgTWF0aC5wb3codGhpcy55LCAyKSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbm9ybWFsaXplZCgpOlZlY3RvcjIge1xyXG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCgpID09PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudGltZXMoMS90aGlzLmxlbmd0aCgpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRvdCh2ZWN0b3I6VmVjdG9yMik6bnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy54ICogdmVjdG9yLnggKyB0aGlzLnkgKiB2ZWN0b3IueTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhbXAobWFnbml0dWRlOm51bWJlcik6dm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoKCkgPiBtYWduaXR1ZGUpIHtcclxuICAgICAgICAgICAgdGhpcy5ub3JtYWxpemUoKVxyXG4gICAgICAgICAgICB0aGlzLm11bHRpcGx5QnkobWFnbml0dWRlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNvcHkoKTpWZWN0b3IyIHtcclxuICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjIodGhpcy54LCB0aGlzLnkpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIE1hc3Mge1xyXG4gICAgcHJpdmF0ZSBzcHJpbmdzOlNwcmluZ1tdO1xyXG4gICAgcHJpdmF0ZSBfdmVsb2NpdHk6VmVjdG9yMjtcclxuICAgIHB1YmxpYyBpc0JlaW5nRHJhZ2dlZDpib29sZWFuID0gZmFsc2U7XHJcbiAgICBwdWJsaWMgcmVsYXRpdmVNb3VzZVBvc2l0aW9uOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3Bvc2l0aW9uOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigyNSwgMjUpLCBwcml2YXRlIG1hc3M6bnVtYmVyID0gMSwgcHJpdmF0ZSBzdGlmZm5lc3M6bnVtYmVyID0gMWUtNywgcHJpdmF0ZSBkYW1waW5nOm51bWJlciA9IDFlMCwgcHJpdmF0ZSBfc2l6ZTpWZWN0b3IyID0gbmV3IFZlY3RvcjIoNTAsIDUwKSwgcHJpdmF0ZSBkcmFnQ29lZmZpY2llbnQ6bnVtYmVyID0gNWUtNCkge1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncyA9IFtdO1xyXG4gICAgICAgIHRoaXMuX3ZlbG9jaXR5ID0gbmV3IFZlY3RvcjIoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIGdldCBwb3NpdGlvbigpIDogVmVjdG9yMiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCB2ZWxvY2l0eSgpIDogVmVjdG9yMiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlbG9jaXR5O1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCBzaXplKCkgOiBWZWN0b3IyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2l6ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcHVibGljIGdldCBsZWZ0KCkgOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi54IC0gdGhpcy5fc2l6ZS54LzI7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgZ2V0IHJpZ2h0KCkgOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi54ICsgdGhpcy5fc2l6ZS54LzI7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgZ2V0IHRvcCgpIDogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24ueSAtIHRoaXMuX3NpemUueS8yO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCBib3R0b20oKSA6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnkgKyB0aGlzLl9zaXplLnkvMjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IG1pblNpemUoKSA6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWluKHRoaXMuX3NpemUueCwgdGhpcy5fc2l6ZS55KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkU3ByaW5nKHNwcmluZzpTcHJpbmcpOnZvaWQge1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncy5wdXNoKHNwcmluZyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyB1cGRhdGUoY2FudmFzOkhUTUxDYW52YXNFbGVtZW50LCBkZWx0YVRpbWU6bnVtYmVyLCBtb3VzZVBvc2l0aW9uOlZlY3RvcjIsIGdyYXZpdHk6bnVtYmVyLCBtYXhGb3JjZTpudW1iZXIsIG1heFNwZWVkOm51bWJlcik6dm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCZWluZ0RyYWdnZWQpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2xkUG9zaXRpb24gPSB0aGlzLl9wb3NpdGlvbi5jb3B5KCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uID0gbW91c2VQb3NpdGlvbi5taW51cyh0aGlzLnJlbGF0aXZlTW91c2VQb3NpdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZlbG9jaXR5ID0gdGhpcy5fcG9zaXRpb24ubWludXMob2xkUG9zaXRpb24pLnRpbWVzKDEvZGVsdGFUaW1lKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgZm9yY2UgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgICAgICAgICAvLyBHcmF2aXR5XHJcbiAgICAgICAgICAgIGZvcmNlLmFkZChuZXcgVmVjdG9yMigwLCB0aGlzLm1hc3MgKiBncmF2aXR5KSk7XHJcbiAgICAgICAgICAgIC8vIFNwcmluZyAgXHJcbiAgICAgICAgICAgIHRoaXMuc3ByaW5ncy5mb3JFYWNoKHNwcmluZyA9PiB7Zm9yY2UuYWRkKHNwcmluZy5nZXRGb3JjZSh0aGlzKSl9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEJvdW5jZSBvZmYgd2FsbHNcclxuICAgICAgICAgICAgbGV0IGNvbnRhY3RTcHJpbmdzOkNvbnRhY3RTcHJpbmdbXSA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sZWZ0IDw9IDApICAgICAgICAgICAgICAgICB7Y29udGFjdFNwcmluZ3MucHVzaChuZXcgQ29udGFjdFNwcmluZyh0aGlzLCBuZXcgTWFzcyhuZXcgVmVjdG9yMigtdGhpcy5fc2l6ZS54LzIgICAgICAgICAgICAgICAgLCB0aGlzLl9wb3NpdGlvbi55KSksIHRoaXMuX3NpemUueCkpfSAvLyBMZWZ0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJpZ2h0ID49IGNhbnZhcy53aWR0aCkgICAgIHtjb250YWN0U3ByaW5ncy5wdXNoKG5ldyBDb250YWN0U3ByaW5nKHRoaXMsIG5ldyBNYXNzKG5ldyBWZWN0b3IyKGNhbnZhcy53aWR0aCt0aGlzLl9zaXplLngvMiAgICAsIHRoaXMuX3Bvc2l0aW9uLnkpKSwgdGhpcy5fc2l6ZS54KSl9IC8vIFJpZ2h0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRvcCA8PSAwKSAgICAgICAgICAgICAgICAgIHtjb250YWN0U3ByaW5ncy5wdXNoKG5ldyBDb250YWN0U3ByaW5nKHRoaXMsIG5ldyBNYXNzKG5ldyBWZWN0b3IyKHRoaXMuX3Bvc2l0aW9uLngsIC10aGlzLl9zaXplLnkvMiAgICAgICAgICAgICAgICApKSwgdGhpcy5fc2l6ZS55KSl9IC8vIFRvcFxyXG4gICAgICAgICAgICBpZiAodGhpcy5ib3R0b20gPj0gY2FudmFzLmhlaWdodCkgICB7Y29udGFjdFNwcmluZ3MucHVzaChuZXcgQ29udGFjdFNwcmluZyh0aGlzLCBuZXcgTWFzcyhuZXcgVmVjdG9yMih0aGlzLl9wb3NpdGlvbi54LCBjYW52YXMuaGVpZ2h0K3RoaXMuX3NpemUueS8yICAgKSksIHRoaXMuX3NpemUueSkpfSAvLyBCb3R0b21cclxuICAgICAgICAgICAgY29udGFjdFNwcmluZ3MuZm9yRWFjaChzcHJpbmcgPT4ge1xyXG4gICAgICAgICAgICAgICAgZm9yY2UuYWRkKHNwcmluZy5nZXRGb3JjZSh0aGlzKSl9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIEFpciByZXNpc3RhbmNlXHJcbiAgICAgICAgICAgIGZvcmNlLmFkZCh0aGlzLl92ZWxvY2l0eS5ub3JtYWxpemVkKCkudGltZXMoLXRoaXMuZHJhZ0NvZWZmaWNpZW50ICogTWF0aC5wb3codGhpcy5fdmVsb2NpdHkubGVuZ3RoKCksIDIpKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDb21wdXRlIGRpZmZlcmVudGlhbCBlcXVhdGlvbnNcclxuICAgICAgICAgICAgbGV0IGFjY2VsZXJhdGlvbjpWZWN0b3IyID0gZm9yY2UudGltZXMoMS90aGlzLm1hc3MpO1xyXG4gICAgICAgICAgICB0aGlzLl92ZWxvY2l0eS5hZGQoYWNjZWxlcmF0aW9uLnRpbWVzKGRlbHRhVGltZSkpO1xyXG4gICAgICAgICAgICB0aGlzLl92ZWxvY2l0eS5jbGFtcChtYXhTcGVlZCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3Bvc2l0aW9uLmFkZCh0aGlzLl92ZWxvY2l0eS50aW1lcyhkZWx0YVRpbWUpKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFB1dCBoYXJkIGxpbWl0IG9uIHdhbGxzXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJpZ2h0IDw9IDApICAgICAgICAgICAge3RoaXMuX3ZlbG9jaXR5LnggPSAwOyB0aGlzLl9wb3NpdGlvbi54ID0gLXRoaXMuc2l6ZS54LzIgKyAxfSAvLyBMZWZ0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxlZnQgPj0gY2FudmFzLndpZHRoKSAge3RoaXMuX3ZlbG9jaXR5LnggPSAwOyB0aGlzLl9wb3NpdGlvbi54ID0gY2FudmFzLndpZHRoICsgdGhpcy5zaXplLngvMiAtIDF9IC8vIFJpZ2h0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmJvdHRvbSA8PSAwKSAgICAgICAgICAge3RoaXMuX3ZlbG9jaXR5LnkgPSAwOyB0aGlzLl9wb3NpdGlvbi55ID0gLXRoaXMuc2l6ZS55LzIgKyAxfSAvLyBUb3BcclxuICAgICAgICAgICAgaWYgKHRoaXMudG9wID49IGNhbnZhcy5oZWlnaHQpICB7dGhpcy5fdmVsb2NpdHkueSA9IDA7IHRoaXMuX3Bvc2l0aW9uLnkgPSBjYW52YXMuaGVpZ2h0ICsgdGhpcy5zaXplLnkvMiAtIDF9IC8vIEJvdHRvbVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhdyhjdHg6Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTp2b2lkIHtcclxuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XHJcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgIC8vIGN0eC5yb3VuZFJlY3QoXHJcbiAgICAgICAgLy8gICAgIHRoaXMubGVmdCxcclxuICAgICAgICAvLyAgICAgdGhpcy50b3AsXHJcbiAgICAgICAgLy8gICAgIHRoaXMuX3NpemUueCxcclxuICAgICAgICAvLyAgICAgdGhpcy5fc2l6ZS55LFxyXG4gICAgICAgIC8vICAgICB0aGlzLm1pblNpemUgLyA1XHJcbiAgICAgICAgLy8gKTtcclxuICAgICAgICBjdHguZWxsaXBzZShcclxuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24ueCxcclxuICAgICAgICAgICAgdGhpcy5fcG9zaXRpb24ueSxcclxuICAgICAgICAgICAgdGhpcy5fc2l6ZS54LzIsXHJcbiAgICAgICAgICAgIHRoaXMuX3NpemUueS8yLFxyXG4gICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAwLCAyKk1hdGguUElcclxuICAgICAgICApXHJcbiAgICAgICAgY3R4LmZpbGwoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBTcHJpbmcge1xyXG4gICAgcHJvdGVjdGVkIGxlbmd0aDpudW1iZXIgPSAwO1xyXG4gICAgcHJvdGVjdGVkIHJlbGF0aXZlUG9zOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgcHJvdGVjdGVkIGVsYXN0aWNGb3JjZTpWZWN0b3IyID0gbmV3IFZlY3RvcjIoKTtcclxuICAgIHByb3RlY3RlZCBkYW1waW5nRm9yY2U6VmVjdG9yMiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICBwcm90ZWN0ZWQgZm9yY2U6VmVjdG9yMiA9IG5ldyBWZWN0b3IyKCk7XHJcblxyXG4gICAgcHJvdGVjdGVkIGRlZmF1bHRXaWR0aCA9IDEwO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBtYXNzMTpNYXNzLCBwdWJsaWMgbWFzczI6TWFzcywgcHJvdGVjdGVkIG5hdHVyYWxMZW5ndGggPSAyMDAsIHByb3RlY3RlZCBzdGlmZm5lc3M6bnVtYmVyID0gMWUtNCwgcHJvdGVjdGVkIGRhbXBpbmc6bnVtYmVyID0gMWUtMykge1xyXG4gICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldEZvcmNlKGRhdHVtTWFzczpNYXNzKTpWZWN0b3IyIHtcclxuICAgICAgICBpZiAoZGF0dW1NYXNzID09PSB0aGlzLm1hc3MyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcmNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcmNlLnRpbWVzKC0xKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwZGF0ZSgpOnZvaWQge1xyXG4gICAgICAgIHRoaXMucmVsYXRpdmVQb3MgPSB0aGlzLm1hc3MxLnBvc2l0aW9uLm1pbnVzKHRoaXMubWFzczIucG9zaXRpb24pO1xyXG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5yZWxhdGl2ZVBvcy5sZW5ndGgoKTtcclxuICAgICAgICBsZXQgZGlyZWN0aW9uID0gdGhpcy5yZWxhdGl2ZVBvcy5ub3JtYWxpemVkKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gRWxhc3RpY3NcclxuICAgICAgICB0aGlzLmVsYXN0aWNGb3JjZSA9IGRpcmVjdGlvbi50aW1lcygodGhpcy5sZW5ndGggLSB0aGlzLm5hdHVyYWxMZW5ndGgpICogdGhpcy5zdGlmZm5lc3MpXHJcblxyXG4gICAgICAgIC8vIERhbXBpbmdcclxuICAgICAgICBsZXQgcmVsYXRpdmVTcGVlZDpudW1iZXIgPSB0aGlzLm1hc3MxLnZlbG9jaXR5Lm1pbnVzKHRoaXMubWFzczIudmVsb2NpdHkpLmRvdChkaXJlY3Rpb24pO1xyXG4gICAgICAgIHRoaXMuZGFtcGluZ0ZvcmNlID0gZGlyZWN0aW9uLnRpbWVzKHJlbGF0aXZlU3BlZWQgKiB0aGlzLmRhbXBpbmcpXHJcblxyXG4gICAgICAgIC8vIFRvdGFsIGZvcmNlXHJcbiAgICAgICAgdGhpcy5mb3JjZSA9IHRoaXMuZWxhc3RpY0ZvcmNlLnBsdXModGhpcy5kYW1waW5nRm9yY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KGN0eDpDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpOnZvaWQge1xyXG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuXHJcbiAgICAgICAgY3R4Lm1vdmVUbyh0aGlzLm1hc3MxLnBvc2l0aW9uLngsIHRoaXMubWFzczEucG9zaXRpb24ueSk7XHJcbiAgICAgICAgY3R4LmxpbmVUbyh0aGlzLm1hc3MyLnBvc2l0aW9uLngsIHRoaXMubWFzczIucG9zaXRpb24ueSk7XHJcblxyXG4gICAgICAgIGN0eC5saW5lV2lkdGggPSBNYXRoLm1pbih0aGlzLmRlZmF1bHRXaWR0aCAqIHRoaXMubmF0dXJhbExlbmd0aCAvIHRoaXMubGVuZ3RoLCB0aGlzLm1hc3MxLm1pblNpemUsIHRoaXMubWFzczIubWluU2l6ZSk7XHJcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ2dyYXknO1xyXG5cclxuICAgICAgICBjdHguc3Ryb2tlKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNsYXNzIENvbnRhY3RTcHJpbmcgZXh0ZW5kcyBTcHJpbmcge1xyXG4gICAgcHJpdmF0ZSBoZXJ0ekV4cG9uZW50Om51bWJlciA9IDI7XHJcbiAgICBwcml2YXRlIHBlbmFsdHlFeHBvbmVudDpudW1iZXIgPSAuNTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbWFzczE6TWFzcywgcHVibGljIG1hc3MyOk1hc3MsIHByb3RlY3RlZCBuYXR1cmFsTGVuZ3RoOm51bWJlciwgcHJvdGVjdGVkIHN0aWZmbmVzczpudW1iZXIgPSAxZS01LCBwcm90ZWN0ZWQgZGFtcGluZzpudW1iZXIgPSAxZS0yKSB7XHJcbiAgICAgICAgc3VwZXIobWFzczIsIG1hc3MxLCBuYXR1cmFsTGVuZ3RoLCBzdGlmZm5lc3MsIGRhbXBpbmcpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwZGF0ZSgpOnZvaWQge1xyXG4gICAgICAgIHRoaXMucmVsYXRpdmVQb3MgPSB0aGlzLm1hc3MxLnBvc2l0aW9uLm1pbnVzKHRoaXMubWFzczIucG9zaXRpb24pO1xyXG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5yZWxhdGl2ZVBvcy5sZW5ndGgoKTtcclxuICAgICAgICBsZXQgZGlyZWN0aW9uID0gdGhpcy5yZWxhdGl2ZVBvcy5ub3JtYWxpemVkKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gRWxhc3RpY3NcclxuICAgICAgICBjb25zdCBob29rZSA9IE1hdGgucG93KHRoaXMubmF0dXJhbExlbmd0aCAtIHRoaXMubGVuZ3RoLCB0aGlzLmhlcnR6RXhwb25lbnQpICogdGhpcy5zdGlmZm5lc3M7XHJcbiAgICAgICAgY29uc3QgcGVuYWx0eSA9IDEgKyAxIC8gTWF0aC5wb3codGhpcy5sZW5ndGgsIHRoaXMucGVuYWx0eUV4cG9uZW50KTtcclxuICAgICAgICB0aGlzLmVsYXN0aWNGb3JjZSA9IGRpcmVjdGlvbi50aW1lcyhob29rZSAqIHBlbmFsdHkpLnRpbWVzKC0xKTtcclxuXHJcbiAgICAgICAgLy8gRGFtcGluZ1xyXG4gICAgICAgIGxldCByZWxhdGl2ZVNwZWVkOm51bWJlciA9IHRoaXMubWFzczEudmVsb2NpdHkubWludXModGhpcy5tYXNzMi52ZWxvY2l0eSkuZG90KGRpcmVjdGlvbik7XHJcbiAgICAgICAgdGhpcy5kYW1waW5nRm9yY2UgPSBkaXJlY3Rpb24udGltZXMocmVsYXRpdmVTcGVlZCAqIHRoaXMuZGFtcGluZylcclxuXHJcbiAgICAgICAgLy8gVG90YWwgZm9yY2VcclxuICAgICAgICB0aGlzLmZvcmNlID0gdGhpcy5lbGFzdGljRm9yY2UucGx1cyh0aGlzLmRhbXBpbmdGb3JjZSk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgR2FtZSB7XHJcbiAgICBwcml2YXRlIGN0eDpDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbiAgICBwcml2YXRlIGlzTW91c2VEb3duOmJvb2xlYW4gPSBmYWxzZTtcclxuICAgIHByaXZhdGUgbW91c2VQb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7XHJcblxyXG4gICAgcHJpdmF0ZSBsYXN0VGltZTpudW1iZXI7IC8vIG1pbGxpc2Vjb25kc1xyXG4gICAgcHJpdmF0ZSBkZWx0YVRpbWU6bnVtYmVyOyAvLyBtaWxsaXNlY29uZHNcclxuICAgIHByaXZhdGUgbWF4RGVsdGFUaW1lOm51bWJlciA9IDUwOyAvL21pbGxpc2Vjb25kc1xyXG4gICAgcHJpdmF0ZSBtYXNzZXM6TWFzc1tdO1xyXG4gICAgcHJpdmF0ZSBzcHJpbmdzOlNwcmluZ1tdO1xyXG5cclxuICAgIHByaXZhdGUgZ3Jhdml0eTpudW1iZXIgPSA1ZS00OyAvLyBwaXhlbHMvbXNlYy9tc2VjXHJcbiAgICBwcml2YXRlIG1heEZvcmNlOm51bWJlciA9IDFlLTE7XHJcbiAgICBwcml2YXRlIG1heFNwZWVkOm51bWJlciA9IDFlNDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNhbnZhczpIVE1MQ2FudmFzRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKSBhcyBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcblxyXG4gICAgICAgIHRoaXMubGFzdFRpbWUgPSAwO1xyXG4gICAgICAgIHRoaXMuZGVsdGFUaW1lID0gMDtcclxuXHJcbiAgICAgICAgdGhpcy5tYXNzZXMgPSBbXTtcclxuICAgICAgICB0aGlzLnNwcmluZ3MgPSBbXTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIGFkZE1hc3MobWFzczpNYXNzKTp2b2lkIHtcclxuICAgICAgICB0aGlzLm1hc3Nlcy5wdXNoKG1hc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhZGRTcHJpbmcoc3ByaW5nOlNwcmluZyk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5zcHJpbmdzLnB1c2goc3ByaW5nKTtcclxuICAgICAgICBcclxuICAgICAgICBzcHJpbmcubWFzczEuYWRkU3ByaW5nKHNwcmluZyk7XHJcbiAgICAgICAgc3ByaW5nLm1hc3MyLmFkZFNwcmluZyhzcHJpbmcpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgbW91c2VEb3duKGV2dDpNb3VzZUV2ZW50KTp2b2lkIHtcclxuICAgICAgICB0aGlzLmlzTW91c2VEb3duID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLm1vdXNlUG9zaXRpb24ueCA9IGV2dC54O1xyXG4gICAgICAgIHRoaXMubW91c2VQb3NpdGlvbi55ID0gZXZ0Lnk7XHJcblxyXG4gICAgICAgIC8vIFdvcmsgb3V0IHdoZXRoZXIgdGhlIG1vdXNlIGNsaWNrIHdhcyB3aXRoaW4gYW55IG9mIHRoZSBtYXNzZXNcclxuICAgICAgICB0aGlzLm1hc3Nlcy5mb3JFYWNoKG1hc3MgPT4ge1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBtYXNzLnBvc2l0aW9uLnggLSBtYXNzLnNpemUueCA8PSBldnQueCAmJlxyXG4gICAgICAgICAgICAgICAgbWFzcy5wb3NpdGlvbi54ICsgbWFzcy5zaXplLnggPj0gZXZ0LnggJiZcclxuICAgICAgICAgICAgICAgIG1hc3MucG9zaXRpb24ueSAtIG1hc3Muc2l6ZS55IDw9IGV2dC55ICYmXHJcbiAgICAgICAgICAgICAgICBtYXNzLnBvc2l0aW9uLnkgKyBtYXNzLnNpemUueSA+PSBldnQueSApIHtcclxuICAgICAgICAgICAgICAgICAgICBtYXNzLmlzQmVpbmdEcmFnZ2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBtYXNzLnJlbGF0aXZlTW91c2VQb3NpdGlvbiA9IHRoaXMubW91c2VQb3NpdGlvbi5taW51cyhtYXNzLnBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgcHVibGljIG1vdXNlTW92ZShldnQ6TW91c2VFdmVudCk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5tb3VzZVBvc2l0aW9uLnggPSBldnQueDtcclxuICAgICAgICB0aGlzLm1vdXNlUG9zaXRpb24ueSA9IGV2dC55O1xyXG4gICAgfVxyXG4gICAgcHVibGljIG1vdXNlVXAoZXZ0Ok1vdXNlRXZlbnQpOnZvaWQge1xyXG4gICAgICAgIHRoaXMuaXNNb3VzZURvd24gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdGhpcy5tYXNzZXMuZm9yRWFjaChtYXNzID0+IG1hc3MuaXNCZWluZ0RyYWdnZWQgPSBmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0KCk6dm9pZCB7XHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMubWFpbkxvb3AuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtYWluTG9vcChjdXJyZW50VGltZTpudW1iZXIpOnZvaWQge1xyXG4gICAgICAgIHRoaXMuZGVsdGFUaW1lID0gTWF0aC5taW4oY3VycmVudFRpbWUgLSB0aGlzLmxhc3RUaW1lLCB0aGlzLm1heERlbHRhVGltZSk7XHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IGN1cnJlbnRUaW1lO1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLmRlbHRhVGltZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5kcmF3KCk7XHJcblxyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm1haW5Mb29wLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlKGRlbHRhVGltZTpudW1iZXIpOnZvaWQge1xyXG4gICAgICAgIHRoaXMubWFzc2VzLmZvckVhY2goKG1hc3MpID0+IG1hc3MudXBkYXRlKHRoaXMuY2FudmFzLCBkZWx0YVRpbWUsIHRoaXMubW91c2VQb3NpdGlvbiwgdGhpcy5ncmF2aXR5LCB0aGlzLm1heEZvcmNlLCB0aGlzLm1heFNwZWVkKSk7XHJcbiAgICAgICAgdGhpcy5zcHJpbmdzLmZvckVhY2goKHNwcmluZykgPT4gc3ByaW5nLnVwZGF0ZSgpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRyYXcoKTp2b2lkIHtcclxuICAgICAgICAvLyBDbGVhciBzY3JlZW5cclxuICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcblxyXG4gICAgICAgIHRoaXMuc3ByaW5ncy5mb3JFYWNoKChzdHJpbmcpID0+IHN0cmluZy5kcmF3KHRoaXMuY3R4KSk7XHJcbiAgICAgICAgdGhpcy5tYXNzZXMuZm9yRWFjaCgobWFzcykgPT4gbWFzcy5kcmF3KHRoaXMuY3R4KSk7XHJcbiAgICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgR2FtZSwgTWFzcywgU3ByaW5nLCBWZWN0b3IyIH0gZnJvbSBcIi4vY2xhc3Nlc1wiO1xyXG5cclxuY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYW52YXNcIikgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XHJcblxyXG5mdW5jdGlvbiByZXNpemVDYW52YXMoKTogdm9pZCB7XHJcbiAgICBjYW52YXMud2lkdGggID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG59XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgcmVzaXplQ2FudmFzKVxyXG5yZXNpemVDYW52YXMoKVxyXG5cclxuXHJcbmNvbnN0IGdhbWUgPSBuZXcgR2FtZShjYW52YXMpO1xyXG5cclxuY2FudmFzLm9ubW91c2Vkb3duID0gZ2FtZS5tb3VzZURvd24uYmluZChnYW1lKTtcclxuY2FudmFzLm9ubW91c2Vtb3ZlID0gZ2FtZS5tb3VzZU1vdmUuYmluZChnYW1lKTtcclxuY2FudmFzLm9ubW91c2V1cCA9IGdhbWUubW91c2VVcC5iaW5kKGdhbWUpO1xyXG5cclxubGV0IG1hc3MxID0gbmV3IE1hc3MobmV3IFZlY3RvcjIoMTUsIDMwKSk7XHJcbmxldCBtYXNzMiA9IG5ldyBNYXNzKG5ldyBWZWN0b3IyKDMwLCAzMDApKTtcclxubGV0IG1hc3MzID0gbmV3IE1hc3MobmV3IFZlY3RvcjIoMzAwLCAzMCkpO1xyXG5sZXQgbWFzczQgPSBuZXcgTWFzcyhuZXcgVmVjdG9yMigzMDAsIDMwMCkpO1xyXG5nYW1lLmFkZE1hc3MobWFzczEpO1xyXG5nYW1lLmFkZE1hc3MobWFzczIpO1xyXG5nYW1lLmFkZE1hc3MobWFzczMpO1xyXG5nYW1lLmFkZE1hc3MobWFzczQpO1xyXG5cclxubGV0IHNwcmluZzEgPSBuZXcgU3ByaW5nKG1hc3MxLCBtYXNzMiwgMzAwKTtcclxubGV0IHNwcmluZzIgPSBuZXcgU3ByaW5nKG1hc3MyLCBtYXNzMyk7XHJcbmxldCBzcHJpbmczID0gbmV3IFNwcmluZyhtYXNzMSwgbWFzczMpO1xyXG5sZXQgc3ByaW5nNCA9IG5ldyBTcHJpbmcobWFzczMsIG1hc3M0KTtcclxubGV0IHNwcmluZzUgPSBuZXcgU3ByaW5nKG1hc3MyLCBtYXNzNCk7XHJcbmdhbWUuYWRkU3ByaW5nKHNwcmluZzEpO1xyXG5nYW1lLmFkZFNwcmluZyhzcHJpbmcyKTtcclxuZ2FtZS5hZGRTcHJpbmcoc3ByaW5nMyk7XHJcbmdhbWUuYWRkU3ByaW5nKHNwcmluZzQpO1xyXG5nYW1lLmFkZFNwcmluZyhzcHJpbmc1KTtcclxuXHJcbmdhbWUuc3RhcnQoKTtcclxuIl0sIm5hbWVzIjpbIngiLCJ5IiwiYWRkIiwidmVjdG9yIiwidGhpcyIsInN1YnRyYWN0IiwibXVsdGlwbHlCeSIsInNjYWxhciIsIm5vcm1hbGl6ZSIsImxlbmd0aCIsInBsdXMiLCJWZWN0b3IyIiwibWludXMiLCJ0aW1lcyIsIk1hdGgiLCJzcXJ0IiwicG93Iiwibm9ybWFsaXplZCIsImRvdCIsImNsYW1wIiwibWFnbml0dWRlIiwiY29weSIsIl9wb3NpdGlvbiIsIm1hc3MiLCJzdGlmZm5lc3MiLCJkYW1waW5nIiwiX3NpemUiLCJkcmFnQ29lZmZpY2llbnQiLCJpc0JlaW5nRHJhZ2dlZCIsInJlbGF0aXZlTW91c2VQb3NpdGlvbiIsInNwcmluZ3MiLCJfdmVsb2NpdHkiLCJtaW4iLCJhZGRTcHJpbmciLCJzcHJpbmciLCJwdXNoIiwidXBkYXRlIiwiY2FudmFzIiwiZGVsdGFUaW1lIiwibW91c2VQb3NpdGlvbiIsImdyYXZpdHkiLCJtYXhGb3JjZSIsIm1heFNwZWVkIiwib2xkUG9zaXRpb24iLCJmb3JFYWNoIiwiZ2V0Rm9yY2UiLCJjb250YWN0U3ByaW5ncyIsImxlZnQiLCJDb250YWN0U3ByaW5nIiwiTWFzcyIsInJpZ2h0Iiwid2lkdGgiLCJ0b3AiLCJib3R0b20iLCJoZWlnaHQiLCJhY2NlbGVyYXRpb24iLCJzaXplIiwiZHJhdyIsImN0eCIsInN0cm9rZVN0eWxlIiwiYmVnaW5QYXRoIiwiZWxsaXBzZSIsIlBJIiwiZmlsbCIsIm1hc3MxIiwibWFzczIiLCJuYXR1cmFsTGVuZ3RoIiwicmVsYXRpdmVQb3MiLCJlbGFzdGljRm9yY2UiLCJkYW1waW5nRm9yY2UiLCJmb3JjZSIsImRlZmF1bHRXaWR0aCIsImRhdHVtTWFzcyIsInBvc2l0aW9uIiwiZGlyZWN0aW9uIiwicmVsYXRpdmVTcGVlZCIsInZlbG9jaXR5IiwibW92ZVRvIiwibGluZVRvIiwibGluZVdpZHRoIiwibWluU2l6ZSIsInN0cm9rZSIsImhlcnR6RXhwb25lbnQiLCJwZW5hbHR5RXhwb25lbnQiLCJob29rZSIsInBlbmFsdHkiLCJTcHJpbmciLCJpc01vdXNlRG93biIsIm1heERlbHRhVGltZSIsImdldENvbnRleHQiLCJsYXN0VGltZSIsIm1hc3NlcyIsImFkZE1hc3MiLCJtb3VzZURvd24iLCJldnQiLCJtb3VzZU1vdmUiLCJtb3VzZVVwIiwic3RhcnQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtYWluTG9vcCIsImJpbmQiLCJjdXJyZW50VGltZSIsImNsZWFyUmVjdCIsInN0cmluZyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZXNpemVDYW52YXMiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2FtZSIsIkdhbWUiLCJvbm1vdXNlZG93biIsIm9ubW91c2Vtb3ZlIiwib25tb3VzZXVwIiwibWFzczMiLCJtYXNzNCIsInNwcmluZzEiLCJzcHJpbmcyIiwic3ByaW5nMyIsInNwcmluZzQiLCJzcHJpbmc1Il0sInNvdXJjZVJvb3QiOiIifQ==