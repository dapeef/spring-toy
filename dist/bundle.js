(()=>{"use strict";var t=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},t.prototype.plus=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.minus=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.times=function(i){return new t(this.x*i,this.y*i)},t.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.normalize=function(){return this.times(1/this.length())},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t}(),i=function(){function i(i,e,s,n,o){void 0===i&&(i=new t(25,25)),void 0===e&&(e=1),void 0===s&&(s=1e-7),void 0===n&&(n=1),void 0===o&&(o=new t(50,50)),this._position=i,this.mass=e,this.stiffness=s,this.damping=n,this.size=o,this.springs=[],this._velocity=new t}return Object.defineProperty(i.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"velocity",{get:function(){return this._velocity},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"left",{get:function(){return this._position.x-this.size.x/2},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this._position.x+this.size.x/2},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this._position.y-this.size.y/2},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this._position.y+this.size.y/2},enumerable:!1,configurable:!0}),i.prototype.addSpring=function(t){this.springs.push(t)},i.prototype.update=function(i,e,s){var n=this,o=new t;o.add(new t(0,this.mass*s)),this.springs.forEach((function(t){o.add(t.getElasticForce(n)),o.add(t.getDampingForce(n))}));var r=o.times(1/this.mass);this._velocity.add(r.times(e)),Math.abs(this._velocity.length())<=1e-20&&(this._velocity=new t),this._position.add(this._velocity.times(e))},i.prototype.draw=function(t){t.fillRect(this.left,this.top,this.size.x,this.size.y)},i}(),e=function(){function i(i,e,s,n,o){void 0===s&&(s=200),void 0===n&&(n=1e-7),void 0===o&&(o=1e-4),this.mass1=i,this.mass2=e,this.naturalLength=s,this.stiffness=n,this.damping=o,this.length=0,this.relativePos=new t,this.elasticForce=new t,this.dampingForce=new t,this.update()}return i.prototype.getElasticForce=function(t){return t===this.mass2?this.elasticForce:this.elasticForce.times(-1)},i.prototype.getDampingForce=function(t){return t===this.mass2?this.dampingForce:this.dampingForce.times(-1)},i.prototype.update=function(){this.relativePos=this.mass1.position.minus(this.mass2.position),this.length=this.relativePos.length();var t=this.relativePos.normalize();this.elasticForce=t.times((this.length-this.naturalLength)*this.stiffness);var i=this.mass1.velocity.minus(this.mass2.velocity).dot(t);this.dampingForce=t.times(i*this.damping),console.log(this.length),console.log(i),console.log(this.elasticForce),console.log(this.dampingForce)},i.prototype.draw=function(t){},i}(),s=function(){function t(t){this.canvas=t,this.gravity=0,this.ctx=t.getContext("2d"),this.lastTime=0,this.deltaTime=0,this.masses=[],this.springs=[]}return t.prototype.addMass=function(t){this.masses.push(t)},t.prototype.addSpring=function(t){this.springs.push(t),t.mass1.addSpring(t),t.mass2.addSpring(t)},t.prototype.start=function(){requestAnimationFrame(this.mainLoop.bind(this))},t.prototype.mainLoop=function(t){this.deltaTime=t-this.lastTime/1e3,this.lastTime=t,this.update(this.deltaTime),this.draw(),requestAnimationFrame(this.mainLoop.bind(this))},t.prototype.update=function(t){var i=this;console.log("Update!"),this.masses.forEach((function(e){return e.update(i.canvas,t,i.gravity)})),this.springs.forEach((function(t){return t.update()}))},t.prototype.draw=function(){var t=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.masses.forEach((function(i){return i.draw(t.ctx)}))},t}(),n=document.getElementById("canvas");function o(){n.width=window.innerWidth,n.height=window.innerHeight}window.addEventListener("resize",o),o();var r=new s(n),h=new i;r.addMass(h);var a=new i(new t(300,300));r.addMass(a);var p=new e(h,a);r.addSpring(p),r.start()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Zy10b3kvLi9zcmMvY2xhc3Nlcy50cyIsIndlYnBhY2s6Ly9zcHJpbmctdG95Ly4vc3JjL21haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFZlY3RvcjIge1xyXG4gICAgY29uc3RydWN0b3IocHVibGljIHg6bnVtYmVyID0gMCwgcHVibGljIHk6bnVtYmVyID0gMCkge307XHJcblxyXG4gICAgcHVibGljIGFkZCh2ZWN0b3I6VmVjdG9yMik6dm9pZCB7XHJcbiAgICAgICAgLy8gQWRkIGFub3RoZXIgVmVjdG9yMiB0byB0aGlzIFZlY3RvcjJcclxuICAgICAgICB0aGlzLnggKz0gdmVjdG9yLng7XHJcbiAgICAgICAgdGhpcy55ICs9IHZlY3Rvci55O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgc3VidHJhY3QodmVjdG9yOlZlY3RvcjIpOnZvaWQge1xyXG4gICAgICAgIC8vIFN1YnRyYWN0IGFub3RoZXIgVmVjdG9yMiBmcm9tIHRoaXMgVmVjdG9yMlxyXG4gICAgICAgIHRoaXMueCAtPSB2ZWN0b3IueDtcclxuICAgICAgICB0aGlzLnkgLT0gdmVjdG9yLnk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHBsdXModmVjdG9yOlZlY3RvcjIpOlZlY3RvcjIge1xyXG4gICAgICAgIC8vIFN1bSB0aGlzIFZlY3RvcjIgd2l0aCBhbm90aGVyIGFuZCByZXR1cm4gYSBuZXcgVmVjdG9yMiBvZiB0aGUgcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCArIHZlY3Rvci54LCB0aGlzLnkgKyB2ZWN0b3IueSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBtaW51cyh2ZWN0b3I6VmVjdG9yMik6VmVjdG9yMiB7XHJcbiAgICAgICAgLy8gU3VtIHRoaXMgVmVjdG9yMiB3aXRoIHRoZSBuZWdhdGl2ZSBvZiBhbm90aGVyIGFuZCByZXR1cm4gYSBuZXcgVmVjdG9yMiBvZiB0aGUgcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCAtIHZlY3Rvci54LCB0aGlzLnkgLSB2ZWN0b3IueSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRpbWVzKHNjYWxhcjpudW1iZXIpOlZlY3RvcjIge1xyXG4gICAgICAgIC8vIFN1bSB0aGlzIFZlY3RvcjIgd2l0aCB0aGUgbmVnYXRpdmUgb2YgYW5vdGhlciBhbmQgcmV0dXJuIGEgbmV3IFZlY3RvcjIgb2YgdGhlIHJlc3VsdFxyXG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih0aGlzLnggKiBzY2FsYXIsIHRoaXMueSAqIHNjYWxhcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGxlbmd0aCgpOm51bWJlciB7XHJcbiAgICAgICAgLy8gR2V0IGxlbmd0aCBvZiB0aGUgdmVjdG9yXHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyh0aGlzLngsIDIpICsgTWF0aC5wb3codGhpcy55LCAyKSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbm9ybWFsaXplKCk6VmVjdG9yMiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXMoMS90aGlzLmxlbmd0aCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZG90KHZlY3RvcjpWZWN0b3IyKTpudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55O1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIE1hc3Mge1xyXG4gICAgcHJpdmF0ZSBzcHJpbmdzOlNwcmluZ1tdO1xyXG4gICAgcHJpdmF0ZSBfdmVsb2NpdHk6VmVjdG9yMjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9wb3NpdGlvbjpWZWN0b3IyID0gbmV3IFZlY3RvcjIoMjUsIDI1KSwgcHJpdmF0ZSBtYXNzOm51bWJlciA9IDEsIHByaXZhdGUgc3RpZmZuZXNzOm51bWJlciA9IDFlLTcsIHByaXZhdGUgZGFtcGluZzpudW1iZXIgPSAxZTAsIHByaXZhdGUgc2l6ZTpWZWN0b3IyID0gbmV3IFZlY3RvcjIoNTAsIDUwKSkge1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncyA9IFtdO1xyXG4gICAgICAgIHRoaXMuX3ZlbG9jaXR5ID0gbmV3IFZlY3RvcjIoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIGdldCBwb3NpdGlvbigpIDogVmVjdG9yMiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uO1xyXG4gICAgfVxyXG4gICAgcHVibGljIGdldCB2ZWxvY2l0eSgpIDogVmVjdG9yMiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZlbG9jaXR5O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgZ2V0IGxlZnQoKSA6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnggLSB0aGlzLnNpemUueC8yO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgZ2V0IHJpZ2h0KCkgOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi54ICsgdGhpcy5zaXplLngvMjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcHVibGljIGdldCB0b3AoKSA6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnkgLSB0aGlzLnNpemUueS8yO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgZ2V0IGJvdHRvbSgpIDogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24ueSArIHRoaXMuc2l6ZS55LzI7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBhZGRTcHJpbmcoc3ByaW5nOlNwcmluZyk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5zcHJpbmdzLnB1c2goc3ByaW5nKTtcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGUoY2FudmFzOkhUTUxDYW52YXNFbGVtZW50LCBkZWx0YVRpbWU6bnVtYmVyLCBncmF2aXR5Om51bWJlcik6dm9pZCB7XHJcbiAgICAgICAgbGV0IGZvcmNlID0gbmV3IFZlY3RvcjIoKTtcclxuICAgICAgICAvLyBHcmF2aXR5XHJcbiAgICAgICAgZm9yY2UuYWRkKG5ldyBWZWN0b3IyKDAsIHRoaXMubWFzcyAqIGdyYXZpdHkpKTtcclxuICAgICAgICAvLyBTcHJpbmcgIFxyXG4gICAgICAgIHRoaXMuc3ByaW5ncy5mb3JFYWNoKHNwcmluZyA9PiB7XHJcbiAgICAgICAgICAgIGZvcmNlLmFkZChzcHJpbmcuZ2V0RWxhc3RpY0ZvcmNlKHRoaXMpKVxyXG4gICAgICAgICAgICBmb3JjZS5hZGQoc3ByaW5nLmdldERhbXBpbmdGb3JjZSh0aGlzKSlcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgYWNjZWxlcmF0aW9uOlZlY3RvcjIgPSBmb3JjZS50aW1lcygxL3RoaXMubWFzcyk7XHJcbiAgICAgICAgdGhpcy5fdmVsb2NpdHkuYWRkKGFjY2VsZXJhdGlvbi50aW1lcyhkZWx0YVRpbWUpKTtcclxuICAgICAgICBpZiAoTWF0aC5hYnModGhpcy5fdmVsb2NpdHkubGVuZ3RoKCkpIDw9IDFlLTIwKSB7dGhpcy5fdmVsb2NpdHkgPSBuZXcgVmVjdG9yMigpfSAvLyBJZiBzcGVlZCBpcyB2ZXJ5IHNtYWxsLCB0aGVuIHNldCB0byAwIHRvIGF2b2lkIGZsb2F0aW5nIGVycm9yc1xyXG4gICAgICAgIHRoaXMuX3Bvc2l0aW9uLmFkZCh0aGlzLl92ZWxvY2l0eS50aW1lcyhkZWx0YVRpbWUpKTtcclxuXHJcbiAgICAgICAgLy8gQm91bmNlIG9mZiB3YWxsc1xyXG4gICAgICAgIC8vIGlmICh0aGlzLmxlZnQgPD0gMCkge3RoaXMuX3ZlbG9jaXR5LnggPSAwOyB0aGlzLl9wb3NpdGlvbi54ID0gdGhpcy5zaXplLngvMn0gLy8gTGVmdFxyXG4gICAgICAgIC8vIGlmICh0aGlzLnJpZ2h0ID49IGNhbnZhcy53aWR0aCkge3RoaXMuX3ZlbG9jaXR5LnggPSAwOyB0aGlzLl9wb3NpdGlvbi54ID0gY2FudmFzLndpZHRoIC0gdGhpcy5zaXplLngvMn0gLy8gUmlnaHRcclxuICAgICAgICAvLyBpZiAodGhpcy50b3AgPD0gMCkge3RoaXMuX3ZlbG9jaXR5LnkgPSAwOyB0aGlzLl9wb3NpdGlvbi55ID0gdGhpcy5zaXplLnkvMn0gLy8gVG9wXHJcbiAgICAgICAgLy8gaWYgKHRoaXMuYm90dG9tID49IGNhbnZhcy5oZWlnaHQpIHt0aGlzLl92ZWxvY2l0eS55ID0gMDsgdGhpcy5fcG9zaXRpb24ueSA9IGNhbnZhcy5oZWlnaHQgLSB0aGlzLnNpemUueS8yfSAvLyBCb3R0b21cclxuICAgICAgICAvLyAvLyBCb3VuY2Ugb2ZmIHdhbGxzXHJcbiAgICAgICAgLy8gaWYgKHRoaXMuX3Bvc2l0aW9uLnggPD0gMCkge3RoaXMudmVsb2NpdHkueCA9IDA7IHRoaXMuX3Bvc2l0aW9uLnggPSB0aGlzLnNpemUueC8yfSAvLyBMZWZ0XHJcbiAgICAgICAgLy8gaWYgKHRoaXMuX3Bvc2l0aW9uLnggPj0gY2FudmFzLndpZHRoKSB7dGhpcy52ZWxvY2l0eS54ID0gMDsgdGhpcy5fcG9zaXRpb24ueCA9IGNhbnZhcy53aWR0aCAtIHRoaXMuc2l6ZS54LzJ9IC8vIFJpZ2h0XHJcbiAgICAgICAgLy8gaWYgKHRoaXMuX3Bvc2l0aW9uLnkgPD0gMCkge3RoaXMudmVsb2NpdHkueSA9IDA7IHRoaXMuX3Bvc2l0aW9uLnkgPSB0aGlzLnNpemUueS8yfSAvLyBUb3BcclxuICAgICAgICAvLyBpZiAodGhpcy5fcG9zaXRpb24ueSA+PSBjYW52YXMuaGVpZ2h0KSB7dGhpcy52ZWxvY2l0eS55ID0gMDsgdGhpcy5fcG9zaXRpb24ueSA9IGNhbnZhcy5oZWlnaHQgLSB0aGlzLnNpemUueS8yfSAvLyBCb3R0b21cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhdyhjdHg6Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTp2b2lkIHtcclxuICAgICAgICBjdHguZmlsbFJlY3QoXHJcbiAgICAgICAgICAgIHRoaXMubGVmdCxcclxuICAgICAgICAgICAgdGhpcy50b3AsXHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZS54LFxyXG4gICAgICAgICAgICB0aGlzLnNpemUueVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgU3ByaW5nIHtcclxuICAgIHByaXZhdGUgbGVuZ3RoOm51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIHJlbGF0aXZlUG9zOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgcHJpdmF0ZSBlbGFzdGljRm9yY2U6VmVjdG9yMiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICBwcml2YXRlIGRhbXBpbmdGb3JjZTpWZWN0b3IyID0gbmV3IFZlY3RvcjIoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbWFzczE6TWFzcywgcHVibGljIG1hc3MyOk1hc3MsIHByaXZhdGUgbmF0dXJhbExlbmd0aD0yMDAsIHByaXZhdGUgc3RpZmZuZXNzOm51bWJlcj0xZS03LCBwcml2YXRlIGRhbXBpbmc6bnVtYmVyID0gMWUtNCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlKClcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RWxhc3RpY0ZvcmNlKGRhdHVtTWFzczpNYXNzKTpWZWN0b3IyIHtcclxuICAgICAgICBpZiAoZGF0dW1NYXNzID09PSB0aGlzLm1hc3MyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVsYXN0aWNGb3JjZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGFzdGljRm9yY2UudGltZXMoLTEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RGFtcGluZ0ZvcmNlKGRhdHVtTWFzczpNYXNzKTpWZWN0b3IyIHtcclxuICAgICAgICBpZiAoZGF0dW1NYXNzID09PSB0aGlzLm1hc3MyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhbXBpbmdGb3JjZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYW1waW5nRm9yY2UudGltZXMoLTEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlKCk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZWxhdGl2ZVBvcyA9IHRoaXMubWFzczEucG9zaXRpb24ubWludXModGhpcy5tYXNzMi5wb3NpdGlvbik7XHJcbiAgICAgICAgdGhpcy5sZW5ndGggPSB0aGlzLnJlbGF0aXZlUG9zLmxlbmd0aCgpO1xyXG4gICAgICAgIGxldCBkaXJlY3Rpb24gPSB0aGlzLnJlbGF0aXZlUG9zLm5vcm1hbGl6ZSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEVsYXN0aWNzXHJcbiAgICAgICAgdGhpcy5lbGFzdGljRm9yY2UgPSBkaXJlY3Rpb24udGltZXMoKHRoaXMubGVuZ3RoIC0gdGhpcy5uYXR1cmFsTGVuZ3RoKSAqIHRoaXMuc3RpZmZuZXNzKVxyXG4gICAgICAgIC8vIGlmICh0aGlzLmVsYXN0aWNGb3JjZS5sZW5ndGgoKSA8PSAxZS0xMCkge3RoaXMuZWxhc3RpY0ZvcmNlID0gbmV3IFZlY3RvcjIoKX0gLy8gSWYgZm9yY2UgaXMgdmVyeSBzbWFsbCwgdGhlbiBzZXQgdG8gMCB0byBhdm9pZCBmbG9hdGluZyBlcnJvcnNlbGFzdGljRm9yY2VcclxuXHJcbiAgICAgICAgLy8gRGFtcGluZ1xyXG4gICAgICAgIGxldCByZWxhdGl2ZVNwZWVkOm51bWJlciA9IHRoaXMubWFzczEudmVsb2NpdHkubWludXModGhpcy5tYXNzMi52ZWxvY2l0eSkuZG90KGRpcmVjdGlvbik7XHJcbiAgICAgICAgdGhpcy5kYW1waW5nRm9yY2UgPSBkaXJlY3Rpb24udGltZXMocmVsYXRpdmVTcGVlZCAqIHRoaXMuZGFtcGluZylcclxuICAgICAgICAvLyBpZiAodGhpcy5kYW1waW5nRm9yY2UubGVuZ3RoKCkgPD0gMWUtMTApIHt0aGlzLmRhbXBpbmdGb3JjZSA9IG5ldyBWZWN0b3IyKCl9IC8vIElmIGZvcmNlIGlzIHZlcnkgc21hbGwsIHRoZW4gc2V0IHRvIDAgdG8gYXZvaWQgZmxvYXRpbmcgZXJyb3JzZWxhc3RpY0ZvcmNlXHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubGVuZ3RoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhyZWxhdGl2ZVNwZWVkKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmVsYXN0aWNGb3JjZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5kYW1waW5nRm9yY2UpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KGN0eDpDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpOnZvaWQge1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBHYW1lIHtcclxuICAgIHByaXZhdGUgY3R4OkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHJcbiAgICBwcml2YXRlIGxhc3RUaW1lOm51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXHJcbiAgICBwcml2YXRlIGRlbHRhVGltZTpudW1iZXI7IC8vIHNlY29uZHNcclxuICAgIHByaXZhdGUgbWFzc2VzOk1hc3NbXTtcclxuICAgIHByaXZhdGUgc3ByaW5nczpTcHJpbmdbXTtcclxuXHJcbiAgICBwcml2YXRlIGdyYXZpdHk6bnVtYmVyID0gMDsgLy8xZS02OyAvLyBwaXhlbHMvc2VjL3NlY1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY2FudmFzOkhUTUxDYW52YXNFbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRDtcclxuXHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IDA7XHJcbiAgICAgICAgdGhpcy5kZWx0YVRpbWUgPSAwO1xyXG5cclxuICAgICAgICB0aGlzLm1hc3NlcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncyA9IFtdO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgYWRkTWFzcyhtYXNzOk1hc3MpOnZvaWQge1xyXG4gICAgICAgIHRoaXMubWFzc2VzLnB1c2gobWFzcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFkZFNwcmluZyhzcHJpbmc6U3ByaW5nKTp2b2lkIHtcclxuICAgICAgICB0aGlzLnNwcmluZ3MucHVzaChzcHJpbmcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHNwcmluZy5tYXNzMS5hZGRTcHJpbmcoc3ByaW5nKTtcclxuICAgICAgICBzcHJpbmcubWFzczIuYWRkU3ByaW5nKHNwcmluZyk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBzdGFydCgpOnZvaWQge1xyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm1haW5Mb29wLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbWFpbkxvb3AoY3VycmVudFRpbWU6bnVtYmVyKTp2b2lkIHtcclxuICAgICAgICB0aGlzLmRlbHRhVGltZSA9IGN1cnJlbnRUaW1lIC0gdGhpcy5sYXN0VGltZSAvIDEwMDA7XHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IGN1cnJlbnRUaW1lO1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLmRlbHRhVGltZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5kcmF3KCk7XHJcblxyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm1haW5Mb29wLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlKGRlbHRhVGltZTpudW1iZXIpOnZvaWQge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdVcGRhdGUhJyk7XHJcblxyXG4gICAgICAgIHRoaXMubWFzc2VzLmZvckVhY2goKG1hc3MpID0+IG1hc3MudXBkYXRlKHRoaXMuY2FudmFzLCBkZWx0YVRpbWUsIHRoaXMuZ3Jhdml0eSkpO1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncy5mb3JFYWNoKChzcHJpbmcpID0+IHNwcmluZy51cGRhdGUoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3KCk6dm9pZCB7XHJcbiAgICAgICAgLy8gQ2xlYXIgc2NyZWVuXHJcbiAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICAgICAgICB0aGlzLm1hc3Nlcy5mb3JFYWNoKChtYXNzKSA9PiBtYXNzLmRyYXcodGhpcy5jdHgpKTtcclxuICAgIH1cclxufVxyXG4iLCJpbXBvcnQgeyBHYW1lLCBNYXNzLCBTcHJpbmcsIFZlY3RvcjIgfSBmcm9tIFwiLi9jbGFzc2VzXCI7XHJcblxyXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcclxuXHJcbmZ1bmN0aW9uIHJlc2l6ZUNhbnZhcygpOiB2b2lkIHtcclxuICAgIGNhbnZhcy53aWR0aCAgPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIGNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbn1cclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCByZXNpemVDYW52YXMpXHJcbnJlc2l6ZUNhbnZhcygpXHJcblxyXG5cclxuY29uc3QgZ2FtZSA9IG5ldyBHYW1lKGNhbnZhcyk7XHJcblxyXG5sZXQgbWFzczEgPSBuZXcgTWFzcygpO1xyXG5nYW1lLmFkZE1hc3MobWFzczEpO1xyXG5cclxubGV0IG1hc3MyID0gbmV3IE1hc3MobmV3IFZlY3RvcjIoMzAwLCAzMDApKTtcclxuZ2FtZS5hZGRNYXNzKG1hc3MyKTtcclxuXHJcbmxldCBzcHJpbmcxID0gbmV3IFNwcmluZyhtYXNzMSwgbWFzczIpO1xyXG5nYW1lLmFkZFNwcmluZyhzcHJpbmcxKTtcclxuXHJcbmdhbWUuc3RhcnQoKTtcclxuIl0sIm5hbWVzIjpbIngiLCJ5IiwiYWRkIiwidmVjdG9yIiwidGhpcyIsInN1YnRyYWN0IiwicGx1cyIsIlZlY3RvcjIiLCJtaW51cyIsInRpbWVzIiwic2NhbGFyIiwibGVuZ3RoIiwiTWF0aCIsInNxcnQiLCJwb3ciLCJub3JtYWxpemUiLCJkb3QiLCJfcG9zaXRpb24iLCJtYXNzIiwic3RpZmZuZXNzIiwiZGFtcGluZyIsInNpemUiLCJzcHJpbmdzIiwiX3ZlbG9jaXR5IiwiYWRkU3ByaW5nIiwic3ByaW5nIiwicHVzaCIsInVwZGF0ZSIsImNhbnZhcyIsImRlbHRhVGltZSIsImdyYXZpdHkiLCJmb3JjZSIsImZvckVhY2giLCJnZXRFbGFzdGljRm9yY2UiLCJnZXREYW1waW5nRm9yY2UiLCJhY2NlbGVyYXRpb24iLCJhYnMiLCJkcmF3IiwiY3R4IiwiZmlsbFJlY3QiLCJsZWZ0IiwidG9wIiwibWFzczEiLCJtYXNzMiIsIm5hdHVyYWxMZW5ndGgiLCJyZWxhdGl2ZVBvcyIsImVsYXN0aWNGb3JjZSIsImRhbXBpbmdGb3JjZSIsImRhdHVtTWFzcyIsInBvc2l0aW9uIiwiZGlyZWN0aW9uIiwicmVsYXRpdmVTcGVlZCIsInZlbG9jaXR5IiwiY29uc29sZSIsImxvZyIsImdldENvbnRleHQiLCJsYXN0VGltZSIsIm1hc3NlcyIsImFkZE1hc3MiLCJzdGFydCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1haW5Mb29wIiwiYmluZCIsImN1cnJlbnRUaW1lIiwiY2xlYXJSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwicmVzaXplQ2FudmFzIiwid2luZG93IiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImdhbWUiLCJHYW1lIiwiTWFzcyIsInNwcmluZzEiLCJTcHJpbmciXSwic291cmNlUm9vdCI6IiJ9