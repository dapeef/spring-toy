(()=>{"use strict";var t,i=(t=function(i,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])},t(i,s)},function(i,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function e(){this.constructor=i}t(i,s),i.prototype=null===s?Object.create(s):(e.prototype=s.prototype,new e)}),s=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},t.prototype.multiplyBy=function(t){this.x*=t,this.y*=t},t.prototype.normalize=function(){this.multiplyBy(1/this.length())},t.prototype.plus=function(i){return new t(this.x+i.x,this.y+i.y)},t.prototype.minus=function(i){return new t(this.x-i.x,this.y-i.y)},t.prototype.times=function(i){return new t(this.x*i,this.y*i)},t.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.normalized=function(){return this.times(1/this.length())},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.clamp=function(t){this.length()>t&&(this.normalize(),this.multiplyBy(t))},t}(),e=function(){function t(t,i,e,n,o){void 0===t&&(t=new s(25,25)),void 0===i&&(i=1),void 0===e&&(e=1e-7),void 0===n&&(n=1),void 0===o&&(o=new s(50,50)),this._position=t,this.mass=i,this.stiffness=e,this.damping=n,this.size=o,this.springs=[],this._velocity=new s}return Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"velocity",{get:function(){return this._velocity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._position.x-this.size.x/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._position.x+this.size.x/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._position.y-this.size.y/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._position.y+this.size.y/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minSize",{get:function(){return Math.min(this.size.x,this.size.y)},enumerable:!1,configurable:!0}),t.prototype.addSpring=function(t){this.springs.push(t)},t.prototype.update=function(i,e,n,h,r){var a=this,p=new s;p.add(new s(0,this.mass*n)),this.springs.forEach((function(t){p.add(t.getForce(a))}));var u=[];this.left<=0&&u.push(new o(this,new t(new s(-this.size.x/2,this._position.y)),this.size.x)),this.right>=i.width&&u.push(new o(this,new t(new s(i.width+this.size.x/2,this._position.y)),this.size.x)),this.top<=0&&u.push(new o(this,new t(new s(this._position.x,-this.size.y/2)),this.size.y)),this.bottom>=i.height&&u.push(new o(this,new t(new s(this._position.x,i.height+this.size.y/2)),this.size.y)),u.forEach((function(t){p.add(t.getForce(a))}));var c=p.times(1/this.mass);this._velocity.add(c.times(e)),this._velocity.clamp(r),this._position.add(this._velocity.times(e))},t.prototype.draw=function(t){t.strokeStyle="black",t.beginPath(),t.roundRect(this.left,this.top,this.size.x,this.size.y,this.minSize/5),t.fill()},t}(),n=function(){function t(t,i,e,n,o){void 0===e&&(e=200),void 0===n&&(n=1e-4),void 0===o&&(o=.001),this.mass1=t,this.mass2=i,this.naturalLength=e,this.stiffness=n,this.damping=o,this.length=0,this.relativePos=new s,this.elasticForce=new s,this.dampingForce=new s,this.force=new s,this.defaultWidth=10,this.update()}return t.prototype.getForce=function(t){return t===this.mass2?this.force:this.force.times(-1)},t.prototype.update=function(){this.relativePos=this.mass1.position.minus(this.mass2.position),this.length=this.relativePos.length();var t=this.relativePos.normalized();this.elasticForce=t.times((this.length-this.naturalLength)*this.stiffness);var i=this.mass1.velocity.minus(this.mass2.velocity).dot(t);this.dampingForce=t.times(i*this.damping),this.force=this.elasticForce.plus(this.dampingForce)},t.prototype.draw=function(t){t.beginPath(),t.moveTo(this.mass1.position.x,this.mass1.position.y),t.lineTo(this.mass2.position.x,this.mass2.position.y),t.lineWidth=Math.min(this.defaultWidth*this.naturalLength/this.length,this.mass1.minSize,this.mass2.minSize),t.strokeStyle="gray",t.stroke()},t}(),o=function(t){function s(i,s,e,n,o){void 0===n&&(n=1e-5),void 0===o&&(o=.01);var h=t.call(this,s,i,e,n,o)||this;return h.mass1=i,h.mass2=s,h.naturalLength=e,h.stiffness=n,h.damping=o,h.hertzExponent=2,h.penaltyExponent=.5,h.update(),h}return i(s,t),s.prototype.update=function(){this.relativePos=this.mass1.position.minus(this.mass2.position),this.length=this.relativePos.length();var t=this.relativePos.normalized(),i=Math.pow(this.naturalLength-this.length,this.hertzExponent)*this.stiffness,s=1+1/Math.pow(this.length,this.penaltyExponent);this.elasticForce=t.times(i*s).times(-1);var e=this.mass1.velocity.minus(this.mass2.velocity).dot(t);this.dampingForce=t.times(e*this.damping),this.force=this.elasticForce.plus(this.dampingForce)},s}(n),h=function(){function t(t){this.canvas=t,this.maxDeltaTime=50,this.gravity=5e-4,this.maxForce=.1,this.maxSpeed=1e4,this.ctx=t.getContext("2d"),this.lastTime=0,this.deltaTime=0,this.masses=[],this.springs=[]}return t.prototype.addMass=function(t){this.masses.push(t)},t.prototype.addSpring=function(t){this.springs.push(t),t.mass1.addSpring(t),t.mass2.addSpring(t)},t.prototype.start=function(){requestAnimationFrame(this.mainLoop.bind(this))},t.prototype.mainLoop=function(t){this.deltaTime=Math.min(t-this.lastTime,this.maxDeltaTime),this.lastTime=t,this.update(this.deltaTime),this.draw(),requestAnimationFrame(this.mainLoop.bind(this))},t.prototype.update=function(t){var i=this;this.masses.forEach((function(s){return s.update(i.canvas,t,i.gravity,i.maxForce,i.maxSpeed)})),this.springs.forEach((function(t){return t.update()}))},t.prototype.draw=function(){var t=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.springs.forEach((function(i){return i.draw(t.ctx)})),this.masses.forEach((function(i){return i.draw(t.ctx)}))},t}(),r=document.getElementById("canvas");function a(){r.width=window.innerWidth,r.height=window.innerHeight}window.addEventListener("resize",a),a();var p=new h(r),u=new e(new s(15,5));p.addMass(u);var c=new e(new s(30,300));p.addMass(c);var l=new n(u,c);p.addSpring(l),p.start()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVMwRCxTQUFTQyxlQUFlLFVBRXZDLFNBQVNDLElBQ0w1RCxFQUFPYSxNQUFTZ0QsT0FBT0MsV0FDdkI5RCxFQUFPZ0IsT0FBUzZDLE9BQU9FLFdBQzNCLENBRUFGLE9BQU9HLGlCQUFpQixTQUFVSixHQUNsQ0EsSUFHQSxJQUFNSyxFQUFPLElBQUlDLEVBQUtsRSxHQUVsQnlCLEVBQVEsSUFBSWQsRUFBSyxJQUFJakMsRUFBUSxHQUFJLElBQ3JDdUYsRUFBS2YsUUFBUXpCLEdBRWIsSUFBSUMsRUFBUSxJQUFJZixFQUFLLElBQUlqQyxFQUFRLEdBQUksTUFDckN1RixFQUFLZixRQUFReEIsR0FFYixJQUFJeUMsRUFBVSxJQUFJdEIsRUFBT3BCLEVBQU9DLEdBQ2hDdUMsRUFBS3JFLFVBQVV1RSxHQUVmRixFQUFLZCxPIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3ByaW5nLXRveS8uL3NyYy9jbGFzc2VzLnRzIiwid2VicGFjazovL3NwcmluZy10b3kvLi9zcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgVmVjdG9yMiB7XHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgeDpudW1iZXIgPSAwLCBwdWJsaWMgeTpudW1iZXIgPSAwKSB7fTtcclxuXHJcbiAgICBwdWJsaWMgYWRkKHZlY3RvcjpWZWN0b3IyKTp2b2lkIHtcclxuICAgICAgICAvLyBBZGQgYW5vdGhlciBWZWN0b3IyIHRvIHRoaXMgVmVjdG9yMlxyXG4gICAgICAgIHRoaXMueCArPSB2ZWN0b3IueDtcclxuICAgICAgICB0aGlzLnkgKz0gdmVjdG9yLnk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBzdWJ0cmFjdCh2ZWN0b3I6VmVjdG9yMik6dm9pZCB7XHJcbiAgICAgICAgLy8gU3VidHJhY3QgYW5vdGhlciBWZWN0b3IyIGZyb20gdGhpcyBWZWN0b3IyXHJcbiAgICAgICAgdGhpcy54IC09IHZlY3Rvci54O1xyXG4gICAgICAgIHRoaXMueSAtPSB2ZWN0b3IueTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbXVsdGlwbHlCeShzY2FsYXI6bnVtYmVyKTp2b2lkIHtcclxuICAgICAgICAvLyBTdW0gdGhpcyBWZWN0b3IyIHdpdGggdGhlIG5lZ2F0aXZlIG9mIGFub3RoZXIgYW5kIHJldHVybiBhIG5ldyBWZWN0b3IyIG9mIHRoZSByZXN1bHRcclxuICAgICAgICB0aGlzLnggKj0gc2NhbGFyXHJcbiAgICAgICAgdGhpcy55ICo9IHNjYWxhcjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbm9ybWFsaXplKCk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5tdWx0aXBseUJ5KDEvdGhpcy5sZW5ndGgoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHBsdXModmVjdG9yOlZlY3RvcjIpOlZlY3RvcjIge1xyXG4gICAgICAgIC8vIFN1bSB0aGlzIFZlY3RvcjIgd2l0aCBhbm90aGVyIGFuZCByZXR1cm4gYSBuZXcgVmVjdG9yMiBvZiB0aGUgcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCArIHZlY3Rvci54LCB0aGlzLnkgKyB2ZWN0b3IueSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBtaW51cyh2ZWN0b3I6VmVjdG9yMik6VmVjdG9yMiB7XHJcbiAgICAgICAgLy8gU3VtIHRoaXMgVmVjdG9yMiB3aXRoIHRoZSBuZWdhdGl2ZSBvZiBhbm90aGVyIGFuZCByZXR1cm4gYSBuZXcgVmVjdG9yMiBvZiB0aGUgcmVzdWx0XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3IyKHRoaXMueCAtIHZlY3Rvci54LCB0aGlzLnkgLSB2ZWN0b3IueSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRpbWVzKHNjYWxhcjpudW1iZXIpOlZlY3RvcjIge1xyXG4gICAgICAgIC8vIFN1bSB0aGlzIFZlY3RvcjIgd2l0aCB0aGUgbmVnYXRpdmUgb2YgYW5vdGhlciBhbmQgcmV0dXJuIGEgbmV3IFZlY3RvcjIgb2YgdGhlIHJlc3VsdFxyXG4gICAgICAgIHJldHVybiBuZXcgVmVjdG9yMih0aGlzLnggKiBzY2FsYXIsIHRoaXMueSAqIHNjYWxhcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGxlbmd0aCgpOm51bWJlciB7XHJcbiAgICAgICAgLy8gR2V0IGxlbmd0aCBvZiB0aGUgdmVjdG9yXHJcbiAgICAgICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyh0aGlzLngsIDIpICsgTWF0aC5wb3codGhpcy55LCAyKSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbm9ybWFsaXplZCgpOlZlY3RvcjIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRpbWVzKDEvdGhpcy5sZW5ndGgoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRvdCh2ZWN0b3I6VmVjdG9yMik6bnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy54ICogdmVjdG9yLnggKyB0aGlzLnkgKiB2ZWN0b3IueTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhbXAobWFnbml0dWRlOm51bWJlcik6dm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoKCkgPiBtYWduaXR1ZGUpIHtcclxuICAgICAgICAgICAgdGhpcy5ub3JtYWxpemUoKVxyXG4gICAgICAgICAgICB0aGlzLm11bHRpcGx5QnkobWFnbml0dWRlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTWFzcyB7XHJcbiAgICBwcml2YXRlIHNwcmluZ3M6U3ByaW5nW107XHJcbiAgICBwcml2YXRlIF92ZWxvY2l0eTpWZWN0b3IyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX3Bvc2l0aW9uOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigyNSwgMjUpLCBwcml2YXRlIG1hc3M6bnVtYmVyID0gMSwgcHJpdmF0ZSBzdGlmZm5lc3M6bnVtYmVyID0gMWUtNywgcHJpdmF0ZSBkYW1waW5nOm51bWJlciA9IDFlMCwgcHJpdmF0ZSBzaXplOlZlY3RvcjIgPSBuZXcgVmVjdG9yMig1MCwgNTApKSB7XHJcbiAgICAgICAgdGhpcy5zcHJpbmdzID0gW107XHJcbiAgICAgICAgdGhpcy5fdmVsb2NpdHkgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHBvc2l0aW9uKCkgOiBWZWN0b3IyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb247XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgZ2V0IHZlbG9jaXR5KCkgOiBWZWN0b3IyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmVsb2NpdHk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBnZXQgbGVmdCgpIDogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24ueCAtIHRoaXMuc2l6ZS54LzI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBnZXQgcmlnaHQoKSA6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Bvc2l0aW9uLnggKyB0aGlzLnNpemUueC8yO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgZ2V0IHRvcCgpIDogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcG9zaXRpb24ueSAtIHRoaXMuc2l6ZS55LzI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHB1YmxpYyBnZXQgYm90dG9tKCkgOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wb3NpdGlvbi55ICsgdGhpcy5zaXplLnkvMjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IG1pblNpemUoKSA6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWluKHRoaXMuc2l6ZS54LCB0aGlzLnNpemUueSk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBhZGRTcHJpbmcoc3ByaW5nOlNwcmluZyk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5zcHJpbmdzLnB1c2goc3ByaW5nKTtcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGUoY2FudmFzOkhUTUxDYW52YXNFbGVtZW50LCBkZWx0YVRpbWU6bnVtYmVyLCBncmF2aXR5Om51bWJlciwgbWF4Rm9yY2U6bnVtYmVyLCBtYXhTcGVlZDpudW1iZXIpOnZvaWQge1xyXG4gICAgICAgIGxldCBmb3JjZSA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICAgICAgLy8gR3Jhdml0eVxyXG4gICAgICAgIGZvcmNlLmFkZChuZXcgVmVjdG9yMigwLCB0aGlzLm1hc3MgKiBncmF2aXR5KSk7XHJcbiAgICAgICAgLy8gU3ByaW5nICBcclxuICAgICAgICB0aGlzLnNwcmluZ3MuZm9yRWFjaChzcHJpbmcgPT4ge2ZvcmNlLmFkZChzcHJpbmcuZ2V0Rm9yY2UodGhpcykpfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQm91bmNlIG9mZiB3YWxsc1xyXG4gICAgICAgIGxldCBjb250YWN0U3ByaW5nczpDb250YWN0U3ByaW5nW10gPSBbXTtcclxuICAgICAgICBpZiAodGhpcy5sZWZ0IDw9IDApICAgICAgICAgICAgICAgICB7Y29udGFjdFNwcmluZ3MucHVzaChuZXcgQ29udGFjdFNwcmluZyh0aGlzLCBuZXcgTWFzcyhuZXcgVmVjdG9yMigtdGhpcy5zaXplLngvMiAgICAgICAgICAgICAgICAsIHRoaXMuX3Bvc2l0aW9uLnkpKSwgdGhpcy5zaXplLngpKX0gLy8gTGVmdFxyXG4gICAgICAgIGlmICh0aGlzLnJpZ2h0ID49IGNhbnZhcy53aWR0aCkgICAgIHtjb250YWN0U3ByaW5ncy5wdXNoKG5ldyBDb250YWN0U3ByaW5nKHRoaXMsIG5ldyBNYXNzKG5ldyBWZWN0b3IyKGNhbnZhcy53aWR0aCt0aGlzLnNpemUueC8yICAgICwgdGhpcy5fcG9zaXRpb24ueSkpLCB0aGlzLnNpemUueCkpfSAvLyBSaWdodFxyXG4gICAgICAgIGlmICh0aGlzLnRvcCA8PSAwKSAgICAgICAgICAgICAgICAgIHtjb250YWN0U3ByaW5ncy5wdXNoKG5ldyBDb250YWN0U3ByaW5nKHRoaXMsIG5ldyBNYXNzKG5ldyBWZWN0b3IyKHRoaXMuX3Bvc2l0aW9uLngsIC10aGlzLnNpemUueS8yICAgICAgICAgICAgICAgICkpLCB0aGlzLnNpemUueSkpfSAvLyBUb3BcclxuICAgICAgICBpZiAodGhpcy5ib3R0b20gPj0gY2FudmFzLmhlaWdodCkgICB7Y29udGFjdFNwcmluZ3MucHVzaChuZXcgQ29udGFjdFNwcmluZyh0aGlzLCBuZXcgTWFzcyhuZXcgVmVjdG9yMih0aGlzLl9wb3NpdGlvbi54LCBjYW52YXMuaGVpZ2h0K3RoaXMuc2l6ZS55LzIgICApKSwgdGhpcy5zaXplLnkpKX0gLy8gQm90dG9tXHJcbiAgICAgICAgY29udGFjdFNwcmluZ3MuZm9yRWFjaChzcHJpbmcgPT4ge1xyXG4gICAgICAgICAgICBmb3JjZS5hZGQoc3ByaW5nLmdldEZvcmNlKHRoaXMpKX0pO1xyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgLy8gZm9yY2UuY2xhbXAobWF4Rm9yY2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBhY2NlbGVyYXRpb246VmVjdG9yMiA9IGZvcmNlLnRpbWVzKDEvdGhpcy5tYXNzKTtcclxuICAgICAgICB0aGlzLl92ZWxvY2l0eS5hZGQoYWNjZWxlcmF0aW9uLnRpbWVzKGRlbHRhVGltZSkpO1xyXG4gICAgICAgIHRoaXMuX3ZlbG9jaXR5LmNsYW1wKG1heFNwZWVkKTtcclxuICAgICAgICB0aGlzLl9wb3NpdGlvbi5hZGQodGhpcy5fdmVsb2NpdHkudGltZXMoZGVsdGFUaW1lKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcoY3R4OkNhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCk6dm9pZCB7XHJcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICBjdHgucm91bmRSZWN0KFxyXG4gICAgICAgICAgICB0aGlzLmxlZnQsXHJcbiAgICAgICAgICAgIHRoaXMudG9wLFxyXG4gICAgICAgICAgICB0aGlzLnNpemUueCxcclxuICAgICAgICAgICAgdGhpcy5zaXplLnksXHJcbiAgICAgICAgICAgIHRoaXMubWluU2l6ZSAvIDVcclxuICAgICAgICApO1xyXG4gICAgICAgIGN0eC5maWxsKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY2xhc3MgU3ByaW5nIHtcclxuICAgIHByb3RlY3RlZCBsZW5ndGg6bnVtYmVyID0gMDtcclxuICAgIHByb3RlY3RlZCByZWxhdGl2ZVBvczpWZWN0b3IyID0gbmV3IFZlY3RvcjIoKTtcclxuICAgIHByb3RlY3RlZCBlbGFzdGljRm9yY2U6VmVjdG9yMiA9IG5ldyBWZWN0b3IyKCk7XHJcbiAgICBwcm90ZWN0ZWQgZGFtcGluZ0ZvcmNlOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xyXG4gICAgcHJvdGVjdGVkIGZvcmNlOlZlY3RvcjIgPSBuZXcgVmVjdG9yMigpO1xyXG5cclxuICAgIHByb3RlY3RlZCBkZWZhdWx0V2lkdGggPSAxMDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbWFzczE6TWFzcywgcHVibGljIG1hc3MyOk1hc3MsIHByb3RlY3RlZCBuYXR1cmFsTGVuZ3RoID0gMjAwLCBwcm90ZWN0ZWQgc3RpZmZuZXNzOm51bWJlciA9IDFlLTQsIHByb3RlY3RlZCBkYW1waW5nOm51bWJlciA9IDFlLTMpIHtcclxuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRGb3JjZShkYXR1bU1hc3M6TWFzcyk6VmVjdG9yMiB7XHJcbiAgICAgICAgaWYgKGRhdHVtTWFzcyA9PT0gdGhpcy5tYXNzMikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JjZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JjZS50aW1lcygtMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGUoKTp2b2lkIHtcclxuICAgICAgICB0aGlzLnJlbGF0aXZlUG9zID0gdGhpcy5tYXNzMS5wb3NpdGlvbi5taW51cyh0aGlzLm1hc3MyLnBvc2l0aW9uKTtcclxuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMucmVsYXRpdmVQb3MubGVuZ3RoKCk7XHJcbiAgICAgICAgbGV0IGRpcmVjdGlvbiA9IHRoaXMucmVsYXRpdmVQb3Mubm9ybWFsaXplZCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEVsYXN0aWNzXHJcbiAgICAgICAgdGhpcy5lbGFzdGljRm9yY2UgPSBkaXJlY3Rpb24udGltZXMoKHRoaXMubGVuZ3RoIC0gdGhpcy5uYXR1cmFsTGVuZ3RoKSAqIHRoaXMuc3RpZmZuZXNzKVxyXG5cclxuICAgICAgICAvLyBEYW1waW5nXHJcbiAgICAgICAgbGV0IHJlbGF0aXZlU3BlZWQ6bnVtYmVyID0gdGhpcy5tYXNzMS52ZWxvY2l0eS5taW51cyh0aGlzLm1hc3MyLnZlbG9jaXR5KS5kb3QoZGlyZWN0aW9uKTtcclxuICAgICAgICB0aGlzLmRhbXBpbmdGb3JjZSA9IGRpcmVjdGlvbi50aW1lcyhyZWxhdGl2ZVNwZWVkICogdGhpcy5kYW1waW5nKVxyXG5cclxuICAgICAgICAvLyBUb3RhbCBmb3JjZVxyXG4gICAgICAgIHRoaXMuZm9yY2UgPSB0aGlzLmVsYXN0aWNGb3JjZS5wbHVzKHRoaXMuZGFtcGluZ0ZvcmNlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhdyhjdHg6Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKTp2b2lkIHtcclxuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XHJcblxyXG4gICAgICAgIGN0eC5tb3ZlVG8odGhpcy5tYXNzMS5wb3NpdGlvbi54LCB0aGlzLm1hc3MxLnBvc2l0aW9uLnkpO1xyXG4gICAgICAgIGN0eC5saW5lVG8odGhpcy5tYXNzMi5wb3NpdGlvbi54LCB0aGlzLm1hc3MyLnBvc2l0aW9uLnkpO1xyXG5cclxuICAgICAgICBjdHgubGluZVdpZHRoID0gTWF0aC5taW4odGhpcy5kZWZhdWx0V2lkdGggKiB0aGlzLm5hdHVyYWxMZW5ndGggLyB0aGlzLmxlbmd0aCwgdGhpcy5tYXNzMS5taW5TaXplLCB0aGlzLm1hc3MyLm1pblNpemUpO1xyXG4gICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdncmF5JztcclxuXHJcbiAgICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBDb250YWN0U3ByaW5nIGV4dGVuZHMgU3ByaW5nIHtcclxuICAgIHByaXZhdGUgaGVydHpFeHBvbmVudDpudW1iZXIgPSAyO1xyXG4gICAgcHJpdmF0ZSBwZW5hbHR5RXhwb25lbnQ6bnVtYmVyID0gLjU7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHVibGljIG1hc3MxOk1hc3MsIHB1YmxpYyBtYXNzMjpNYXNzLCBwcm90ZWN0ZWQgbmF0dXJhbExlbmd0aDpudW1iZXIsIHByb3RlY3RlZCBzdGlmZm5lc3M6bnVtYmVyID0gMWUtNSwgcHJvdGVjdGVkIGRhbXBpbmc6bnVtYmVyID0gMWUtMikge1xyXG4gICAgICAgIHN1cGVyKG1hc3MyLCBtYXNzMSwgbmF0dXJhbExlbmd0aCwgc3RpZmZuZXNzLCBkYW1waW5nKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGUoKTp2b2lkIHtcclxuICAgICAgICB0aGlzLnJlbGF0aXZlUG9zID0gdGhpcy5tYXNzMS5wb3NpdGlvbi5taW51cyh0aGlzLm1hc3MyLnBvc2l0aW9uKTtcclxuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMucmVsYXRpdmVQb3MubGVuZ3RoKCk7XHJcbiAgICAgICAgbGV0IGRpcmVjdGlvbiA9IHRoaXMucmVsYXRpdmVQb3Mubm9ybWFsaXplZCgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEVsYXN0aWNzXHJcbiAgICAgICAgY29uc3QgaG9va2UgPSBNYXRoLnBvdyh0aGlzLm5hdHVyYWxMZW5ndGggLSB0aGlzLmxlbmd0aCwgdGhpcy5oZXJ0ekV4cG9uZW50KSAqIHRoaXMuc3RpZmZuZXNzO1xyXG4gICAgICAgIGNvbnN0IHBlbmFsdHkgPSAxICsgMSAvIE1hdGgucG93KHRoaXMubGVuZ3RoLCB0aGlzLnBlbmFsdHlFeHBvbmVudCk7XHJcbiAgICAgICAgdGhpcy5lbGFzdGljRm9yY2UgPSBkaXJlY3Rpb24udGltZXMoaG9va2UgKiBwZW5hbHR5KS50aW1lcygtMSk7XHJcblxyXG4gICAgICAgIC8vIERhbXBpbmdcclxuICAgICAgICBsZXQgcmVsYXRpdmVTcGVlZDpudW1iZXIgPSB0aGlzLm1hc3MxLnZlbG9jaXR5Lm1pbnVzKHRoaXMubWFzczIudmVsb2NpdHkpLmRvdChkaXJlY3Rpb24pO1xyXG4gICAgICAgIHRoaXMuZGFtcGluZ0ZvcmNlID0gZGlyZWN0aW9uLnRpbWVzKHJlbGF0aXZlU3BlZWQgKiB0aGlzLmRhbXBpbmcpXHJcblxyXG4gICAgICAgIC8vIFRvdGFsIGZvcmNlXHJcbiAgICAgICAgdGhpcy5mb3JjZSA9IHRoaXMuZWxhc3RpY0ZvcmNlLnBsdXModGhpcy5kYW1waW5nRm9yY2UpO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEdhbWUge1xyXG4gICAgcHJpdmF0ZSBjdHg6Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5cclxuICAgIHByaXZhdGUgbGFzdFRpbWU6bnVtYmVyOyAvLyBtaWxsaXNlY29uZHNcclxuICAgIHByaXZhdGUgZGVsdGFUaW1lOm51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXHJcbiAgICBwcml2YXRlIG1heERlbHRhVGltZTpudW1iZXIgPSA1MDsgLy9taWxsaXNlY29uZHNcclxuICAgIHByaXZhdGUgbWFzc2VzOk1hc3NbXTtcclxuICAgIHByaXZhdGUgc3ByaW5nczpTcHJpbmdbXTtcclxuXHJcbiAgICBwcml2YXRlIGdyYXZpdHk6bnVtYmVyID0gNWUtNDsgLy8gcGl4ZWxzL21zZWMvbXNlY1xyXG4gICAgcHJpdmF0ZSBtYXhGb3JjZTpudW1iZXIgPSAxZS0xO1xyXG4gICAgcHJpdmF0ZSBtYXhTcGVlZDpudW1iZXIgPSAxZTQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjYW52YXM6SFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIikgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xyXG5cclxuICAgICAgICB0aGlzLmxhc3RUaW1lID0gMDtcclxuICAgICAgICB0aGlzLmRlbHRhVGltZSA9IDA7XHJcblxyXG4gICAgICAgIHRoaXMubWFzc2VzID0gW107XHJcbiAgICAgICAgdGhpcy5zcHJpbmdzID0gW107XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBhZGRNYXNzKG1hc3M6TWFzcyk6dm9pZCB7XHJcbiAgICAgICAgdGhpcy5tYXNzZXMucHVzaChtYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWRkU3ByaW5nKHNwcmluZzpTcHJpbmcpOnZvaWQge1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncy5wdXNoKHNwcmluZyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgc3ByaW5nLm1hc3MxLmFkZFNwcmluZyhzcHJpbmcpO1xyXG4gICAgICAgIHNwcmluZy5tYXNzMi5hZGRTcHJpbmcoc3ByaW5nKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIHN0YXJ0KCk6dm9pZCB7XHJcbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMubWFpbkxvb3AuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtYWluTG9vcChjdXJyZW50VGltZTpudW1iZXIpOnZvaWQge1xyXG4gICAgICAgIHRoaXMuZGVsdGFUaW1lID0gTWF0aC5taW4oY3VycmVudFRpbWUgLSB0aGlzLmxhc3RUaW1lLCB0aGlzLm1heERlbHRhVGltZSk7XHJcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IGN1cnJlbnRUaW1lO1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLmRlbHRhVGltZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5kcmF3KCk7XHJcblxyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm1haW5Mb29wLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdXBkYXRlKGRlbHRhVGltZTpudW1iZXIpOnZvaWQge1xyXG4gICAgICAgIHRoaXMubWFzc2VzLmZvckVhY2goKG1hc3MpID0+IG1hc3MudXBkYXRlKHRoaXMuY2FudmFzLCBkZWx0YVRpbWUsIHRoaXMuZ3Jhdml0eSwgdGhpcy5tYXhGb3JjZSwgdGhpcy5tYXhTcGVlZCkpO1xyXG4gICAgICAgIHRoaXMuc3ByaW5ncy5mb3JFYWNoKChzcHJpbmcpID0+IHNwcmluZy51cGRhdGUoKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3KCk6dm9pZCB7XHJcbiAgICAgICAgLy8gQ2xlYXIgc2NyZWVuXHJcbiAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICAgICAgICB0aGlzLnNwcmluZ3MuZm9yRWFjaCgoc3RyaW5nKSA9PiBzdHJpbmcuZHJhdyh0aGlzLmN0eCkpO1xyXG4gICAgICAgIHRoaXMubWFzc2VzLmZvckVhY2goKG1hc3MpID0+IG1hc3MuZHJhdyh0aGlzLmN0eCkpO1xyXG4gICAgfVxyXG59XHJcbiIsImltcG9ydCB7IEdhbWUsIE1hc3MsIFNwcmluZywgVmVjdG9yMiB9IGZyb20gXCIuL2NsYXNzZXNcIjtcclxuXHJcbmNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FudmFzXCIpIGFzIEhUTUxDYW52YXNFbGVtZW50O1xyXG5cclxuZnVuY3Rpb24gcmVzaXplQ2FudmFzKCk6IHZvaWQge1xyXG4gICAgY2FudmFzLndpZHRoICA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxufVxyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHJlc2l6ZUNhbnZhcylcclxucmVzaXplQ2FudmFzKClcclxuXHJcblxyXG5jb25zdCBnYW1lID0gbmV3IEdhbWUoY2FudmFzKTtcclxuXHJcbmxldCBtYXNzMSA9IG5ldyBNYXNzKG5ldyBWZWN0b3IyKDE1LCA1KSk7XHJcbmdhbWUuYWRkTWFzcyhtYXNzMSk7XHJcblxyXG5sZXQgbWFzczIgPSBuZXcgTWFzcyhuZXcgVmVjdG9yMigzMCwgMzAwKSk7XHJcbmdhbWUuYWRkTWFzcyhtYXNzMik7XHJcblxyXG5sZXQgc3ByaW5nMSA9IG5ldyBTcHJpbmcobWFzczEsIG1hc3MyKTtcclxuZ2FtZS5hZGRTcHJpbmcoc3ByaW5nMSk7XHJcblxyXG5nYW1lLnN0YXJ0KCk7XHJcbiJdLCJuYW1lcyI6WyJ4IiwieSIsImFkZCIsInZlY3RvciIsInRoaXMiLCJzdWJ0cmFjdCIsIm11bHRpcGx5QnkiLCJzY2FsYXIiLCJub3JtYWxpemUiLCJsZW5ndGgiLCJwbHVzIiwiVmVjdG9yMiIsIm1pbnVzIiwidGltZXMiLCJNYXRoIiwic3FydCIsInBvdyIsIm5vcm1hbGl6ZWQiLCJkb3QiLCJjbGFtcCIsIm1hZ25pdHVkZSIsIl9wb3NpdGlvbiIsIm1hc3MiLCJzdGlmZm5lc3MiLCJkYW1waW5nIiwic2l6ZSIsInNwcmluZ3MiLCJfdmVsb2NpdHkiLCJtaW4iLCJhZGRTcHJpbmciLCJzcHJpbmciLCJwdXNoIiwidXBkYXRlIiwiY2FudmFzIiwiZGVsdGFUaW1lIiwiZ3Jhdml0eSIsIm1heEZvcmNlIiwibWF4U3BlZWQiLCJmb3JjZSIsImZvckVhY2giLCJnZXRGb3JjZSIsImNvbnRhY3RTcHJpbmdzIiwibGVmdCIsIkNvbnRhY3RTcHJpbmciLCJNYXNzIiwicmlnaHQiLCJ3aWR0aCIsInRvcCIsImJvdHRvbSIsImhlaWdodCIsImFjY2VsZXJhdGlvbiIsImRyYXciLCJjdHgiLCJzdHJva2VTdHlsZSIsImJlZ2luUGF0aCIsInJvdW5kUmVjdCIsIm1pblNpemUiLCJmaWxsIiwibWFzczEiLCJtYXNzMiIsIm5hdHVyYWxMZW5ndGgiLCJyZWxhdGl2ZVBvcyIsImVsYXN0aWNGb3JjZSIsImRhbXBpbmdGb3JjZSIsImRlZmF1bHRXaWR0aCIsImRhdHVtTWFzcyIsInBvc2l0aW9uIiwiZGlyZWN0aW9uIiwicmVsYXRpdmVTcGVlZCIsInZlbG9jaXR5IiwibW92ZVRvIiwibGluZVRvIiwibGluZVdpZHRoIiwic3Ryb2tlIiwiaGVydHpFeHBvbmVudCIsInBlbmFsdHlFeHBvbmVudCIsImhvb2tlIiwicGVuYWx0eSIsIlNwcmluZyIsIm1heERlbHRhVGltZSIsImdldENvbnRleHQiLCJsYXN0VGltZSIsIm1hc3NlcyIsImFkZE1hc3MiLCJzdGFydCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1haW5Mb29wIiwiYmluZCIsImN1cnJlbnRUaW1lIiwiY2xlYXJSZWN0Iiwic3RyaW5nIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInJlc2l6ZUNhbnZhcyIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImFkZEV2ZW50TGlzdGVuZXIiLCJnYW1lIiwiR2FtZSIsInNwcmluZzEiXSwic291cmNlUm9vdCI6IiJ9